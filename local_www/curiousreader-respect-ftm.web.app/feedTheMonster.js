/*! For license information please see feedTheMonster.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();class e{x;y;origx;origy;text;img;imageSize;textFontSize;canvasWidth;canvasHeight;imageCenterOffsetX;imageCenterOffsetY;context;tutorialInstance;timerTickingInstance;frame=0;constructor(t,e,i,s,n,a,o,r,h){this.x=n,this.y=a,this.origx=n,this.origy=a,this.canvasWidth=e,this.canvasHeight=i,this.tutorialInstance=h,this.text=s,this.img=o,this.context=t,this.calculateImageAndFontSize(),this.imageCenterOffsetX=this.imageSize/2.3,this.imageCenterOffsetY=this.imageSize/1.5,this.timerTickingInstance=r}calculateImageAndFontSize(){1.4*this.context.measureText(this.text).width>this.canvasHeight/9.5?(this.imageSize=1.1*this.context.measureText(this.text).width,this.textFontSize=this.canvasHeight/25,this.text.length>=3&&this.origx<50&&this.origx<this.canvasWidth/2&&(this.x=this.origx+21)):(this.imageSize=this.canvasHeight/9.5,this.textFontSize=this.canvasHeight/20)}getEase=(t,e,i,s)=>-i/2*(Math.cos(Math.PI*t/s)-1)+e;getX=()=>this.frame>=100?this.x:this.getEase(this.frame,0,this.x,100);getY=()=>this.frame>=100?this.y:this.getEase(this.frame,0,this.y,100);adjustSize(t,e){return t?1.25*e:e}draw(t,e=!1){const i=this.getX()-this.adjustSize(e,this.imageCenterOffsetX),s=this.getY()-this.adjustSize(e,this.imageCenterOffsetY);this.context.fillStyle="red",this.context.shadowColor="rgba(255, 255, 255, 1)",this.context.shadowBlur=12,this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.drawImage(this.img,i,s,this.adjustSize(e,this.imageSize),this.adjustSize(e,this.imageSize)),this.context.fillStyle="white",this.context.font=this.textFontSize+`px ${tt}, monospace`,this.context.textAlign="center",this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowBlur=0,this.context.shadowColor="transparent ",this.context.fillText(this.text,this.getX(),this.getY()),this.frame<100?this.frame=this.frame+1:null==this.tutorialInstance&&null==this.tutorialInstance||this.tutorialInstance.draw(t,this.img,this.imageSize)}}const i="pwa_installed_status",s="storePreviousPlayedLevel",n="is_cached",a="https://globallit-aws-s3-static-webapp-test-us-east-2.s3.us-west-2.amazonaws.com/feed-the-monster",o="LevelSelection1",r="GameScene1",h="EndScene1",l="./assets/audios/Eat.mp3",c=t=>`./assets/audios/Cheering-0${t}.mp3`,d="./assets/audios/onDrag.mp3",u="./assets/audios/intro.mp3",g=["./assets/audios/intro.mp3","./assets/audios/Cheering-02.mp3","./assets/audios/Cheering-03.mp3","./assets/audios/Cheering-01.mp3","./assets/audios/onDrag.mp3","./assets/audios/timeout.mp3","./assets/audios/LevelWinFanfare.mp3","./assets/audios/LevelLoseFanfare.mp3","./assets/audios/ButtonClick.mp3","./assets/audios/Monster Spits wrong stones-01.mp3","./assets/audios/Disapointed-05.mp3","./assets/audios/MonsterSpit.mp3","./assets/audios/Eat.mp3","./assets/audios/PointsAdd.wav","./assets/audios/are-you-sure.mp3"],m="./assets/images/Totem_v02_v01.webp",p="./assets/images/hill_v01.webp",f="./assets/images/fence_v01.webp",v="./assets/images/idle4.png",w="./assets/images/bg_v01.webp",b="./assets/images/Autumn_bg_v01.webp",S="./assets/images/Autumn_hill_v01.webp",y="./assets/images/Autumn_sign_v01.webp",I="./assets/images/Autumn_sign_v01.webp",x="./assets/images/Autumn_fence_v01.webp",T="./assets/images/Winter_bg_01.webp",C="./assets/images/Winter_hill_v01.webp",L="./assets/images/Winter_sign_v01.webp",P="./assets/images/Winter_fence_v01.webp",E="./assets/images/Winter_sign_v01.webp",z="./assets/images/next_btn.webp",k="./assets/images/close_btn.webp",A="./assets/images/popup_bg_v01.webp",D={DEFAULT_BACKGROUND_1:w,ASSETS_PATH_HILL:p,ASSETS_PATH_TOTEM:m,ASSETS_PATH_FENCE:f},B={AUTUMN_BACKGROUND_1:b,AUTUMN_HILL_1:S,AUTUMN_PILLAR_1:y,AUTUMN_SIGN_1:I,AUTUMN_FENCE_1:x},M={WINTER_BACKGROUND_1:T,WINTER_HILL_1:C,WINTER_SIGN_1:L,WINTER_FENCE_1:P,WINTER_PILLAR_1:E},O="GamePlay",N=[5,13,20,30,42],F={english:"Consolas",swahili:"Consolas",wolof:"Consolas",tajik:"Consolas",marathi:"Consolas",amharic:"Consolas",punjabi:"Consolas",tamil:"Consolas",sepedi:"Consolas",gujarati:"Consolas",telugu:"Consolas",tsonga:"Consolas",malay:"Consolas",ndebele:"Consolas",venda:"NotoSans-Regular",siswati:"Consolas",tswana:"Consolas",thai:"Consolas",fula:"Consolas",farsi:"Consolas",burmese:"Consolas",bengali:"Consolas",Azerbaijani:"NotoSans-Regular",Sesotho:"Consolas",Georgian:"Consolas",BrazilianPortuguese:"Consolas",Somali:"Consolas",Hausa:"NotoSans-Regular",Igbo:"Consolas",HatianCreole:"Consolas",Oromo:"Consolas",Luganda:"Consolas",Yoruba:"Consolas",Khmer:"Consolas",Javanese:"Consolas",Urdu:"Consolas",Kinyarwanda:"Consolas",Shona:"Consolas",Kurdish:"Consolas",French:"Consolas",isiXhosa:"Consolas",Afrikaans:"Consolas",Nepali:"Consolas",Ukrainian:"Consolas",Hindi:"Consolas",Tagalog:"Consolas",Vietnamese:"NotoSans-Regular",Pashto:"Consolas",Twi:"NotoSans-Regular",Arabic:"Adobe-Arabic-Bold"};class j{static UrlSubstring="/feedthemonster";static subdomain="https://feedthemonster.curiouscontent.org";static isDeepLink;static levelNum;static isRespect=!1;static getConvertedDevProdURL(t){return et.DevelopmentLink?t.slice(0,t.indexOf(this.UrlSubstring)+this.UrlSubstring.length)+"dev"+t.slice(t.indexOf(this.UrlSubstring)+this.UrlSubstring.length):et.TestLink?t.replace(this.subdomain,a):t}static getLanguageSpecificFont(t){const e=t.toLowerCase();for(const t in F)if(t.toLowerCase()===e)return F[t];return"NotoSans-Regular"}static getRandomNumber(t,e){return Math.floor(Math.random()*(e-t+1))+t}static getExcludedCoordinates(t,e){return{excludeX:t.width*(e/100),excludeY:t.height*(e/100)}}}function R(t,e){const i={};let s=0;const n=Object.keys(t).length;for(let a in t)i[a]=new Image,i[a].onload=function(){++s>=n&&e(i)},i[a].src=t[a]}const H=async t=>{const e=Object.keys(t).map((async e=>{const i=await(async t=>{const e=new Image;return new Promise((i=>{e.onload=()=>i(e),e.src=t}))})(t[e]);return{[e]:i}}));return(await Promise.all(e)).reduce(((t,e)=>({...t,...e})),{})};function X(t,e,i,s,n,a,o=!1){if(o){return Math.sqrt((t-(i+n/2))**2+(e-(s+a/2))**2)<n/2}return t>=i&&t<=i+n&&e>=s&&e<=s+a}const W=()=>"visible"===document.visibilityState,V=(t=!1,e)=>{t?e.classList.remove("show"):e.classList.add("show")};window._callbacks=window._callbacks||{};const U=window._callbacks,Y={sendDataToContainer(t,e){try{if(void 0!==window.Android){const i="object"==typeof e?JSON.stringify(e):e;window.Android.sendDataToContainer(t,i)}}catch(t){console.error("Error sending data to container:",t)}},requestDataFromContainer:t=>new Promise(((e,i)=>{try{void 0!==window.Android?(U[t]=e,window.Android.requestDataFromContainer(t)):i("Android bridge not available: In requestDataFromContainer")}catch(t){i(t)}})),requestInstalledAppInfo:()=>new Promise(((t,e)=>{try{void 0!==window.Android?(U.installedAppInfo=t,window.Android.sendInstalledAppInfoToJS()):e("Android bridge not available: In requestInstalledAppInfo")}catch(t){e(t)}})),requestGameLevelInfo:()=>new Promise(((t,e)=>{try{window.Android?.sendGameLevelInfoToJS?(U.gameLevelInfo=t,window.Android.sendGameLevelInfoToJS()):e("Android bridge not available: sendGameLevelInfoToJS")}catch(t){e(t)}})),_handleDataFromAndroid(t){try{const e=JSON.parse(t),i=e?.type;if("gameLevelInfo"===i&&e.data)return void this._handleGameLevelInfo(e);i&&U[i]&&(U[i](e),delete U[i])}catch(t){console.error("Failed to parse data from Android:",t)}},_handleGameLevelInfo(t){try{if(t&&t.data){const e=t.data,i=window.localStorage.getItem("lang")||"english";localStorage.setItem(i+"gamePlayedInfo",JSON.stringify(e)),U.gameLevelInfo&&(U.gameLevelInfo(e),delete U.gameLevelInfo)}}catch(t){console.error("Failed to process game level info from Android:",t)}}},G=new URLSearchParams(window.location.search);var $=G.get("cr_user_id"),q=null==G.get("source")?null:G.get("source"),K=null==G.get("campaign_id")?null:G.get("campaign_id");let J=null!=G.get("lang")?G.get("lang").toLowerCase():null;var Q=["afrikaans","amharic","arabic","arabictest","australianenglish","azerbaijani","bangla","brazilianportuguese","caboverdecreole","caboverdeportuguese","english","englishwestafrican","farsi","farsitest","french","georgian","gujarati","haitiancreole","hausa","hindi","igbo","indianenglish","isixhosa","javanese","kannada","kinyarwanda","kirundi","kurdish","lugandan","malay","malgache","marathi","ndebele","nepali","oromo","pashto","punjabi","sepedi","sesotho","shona","siswati","somali","southafricanenglish","spanish","swahili","tagalog","tajik","tamil","telugu","thai","tigragna","tsonga","tswana","turkish","twi","ukrainian","venda","vietnamese","wolof","yoruba","zulu"].includes(J)?J:"english",Z=null==G.get("lesson_id")||"0"==G.get("lesson_id")||""==G.get("lesson_id")?"1":G.get("lesson_id");const tt=j.getLanguageSpecificFont(Q),et={DevelopmentLink:!!window.location.href.includes("https://feedthemonsterdev.curiouscontent.org"),TestLink:!!window.location.href.includes(a),DebugMode:!1},it="loadpuzzle",st="stonesdropped",nt="click",at="visibilitychange",ot="./lang/"+Q+"/ftm_"+Q+".json";async function rt(){return await fetch(ot,{method:"GET",headers:{"Content-Type":"application/json"}}).then((t=>t.json().then((t=>t))))}class ht{title;otherAudios;levels;FeedbackTexts;FeedbackAudios;rightToLeft;majVersion;minVersion;version;constructor(t,e,i,s,n,a,o,r,h){this.title=t,this.otherAudios=new lt(e),this.levels=this.getLevels(i),this.FeedbackTexts=new ct(s),this.FeedbackAudios=new dt(a),this.rightToLeft=n,this.majVersion=o,this.minVersion=r,this.version=h}getLevels(t){let e=[];for(let i=0;i<t.length;i++)e.push(new ut(t[i]));return e}}class lt{selctYourPlayer;watchMeGrow;areYouSure;constructor(t){this.selctYourPlayer=t["Select your player"],this.watchMeGrow=t["Watch me grow"],this.areYouSure=t["Are you sure"]}}class ct{fantastic;great;amazing;constructor(t){t.length>=1&&(this.fantastic=t[0]),t.length>=2&&(this.great=t[1]),t.length>=3&&(this.amazing=t[2])}}class dt{fantastic;great;amazing;constructor(t){t.length>=1&&(this.fantastic=t[0]),t.length>=2&&(this.great=t[1]),t.length>=3&&(this.amazing=t[2])}}class ut{puzzles;levelMeta;levelNumber;constructor(t){this.puzzles=this.getPuzzleData(t),this.levelMeta=new pt(t.LevelMeta),this.levelNumber=t.LevelNumber}getPuzzleData(t){let e=[];return t.Puzzles.map(((t,i)=>{e.push(new gt(t))})),e}}class gt{segmentNumber;prompt;foilStones;targetStones;constructor(t){this.segmentNumber=t.SegmentNumber,this.prompt=new mt(t.prompt),this.foilStones=this.getFoilStones(t),this.targetStones=this.getTargetStones(t)}getFoilStones(t){let e=[];return t.foilstones.map(((t,i)=>{e.push(t.StoneText)})),e}getTargetStones(t){let e=[];return t.targetstones.map(((t,i)=>{e.push(t.StoneText)})),e}}class mt{promptText;promptAudio;constructor(t){this.promptText=t.PromptText,this.promptAudio=t.PromptAudio}}class pt{promptFadeOut;letterGroup;levelNumber;protoType;levelType;constructor(t){this.promptFadeOut=t.PromptFadeout,this.letterGroup=t.LetterGroup,this.levelNumber=t.LevelNumber,this.protoType=t.PromptType,this.levelType=t.LevelType}}class ft{static currentlanguage=Q;static setGameLevelScore(t,e){let i=this.calculateStarCount(e),s={levelName:t.levelMeta.levelType,levelNumber:t.levelMeta.levelNumber,score:e,starCount:i};this.setTotalStarCount(i);let n=this.getAllGameLevelInfo(),a=-1;for(let t=0;t<n.length;t++)if(n[t].levelNumber===s.levelNumber){a=t;break}-1!==a&&s.score>n[a].score?n[a]=s:n.push(s),localStorage.setItem(this.currentlanguage+"gamePlayedInfo",JSON.stringify(n))}static getAllGameLevelInfo(){const t=[];return window.Android?.sendGameLevelInfoToJS&&Y.requestGameLevelInfo().then((e=>{e.forEach((e=>{t.push(e)}))})).catch((t=>console.error("Failed to get game level info:",t))),t}static setTotalStarCount(t){let e=this.getTotalStarCount()+t;localStorage.setItem(this.currentlanguage+"totalStarCount",e)}static getTotalStarCount(){const t=localStorage.getItem(this.currentlanguage+"totalStarCount");return null==t?0:parseInt(t)}static calculateStarCount(t){return t>=25&&t<=50?1:t>50&&t<=75?2:t>75&&t<=100?3:0}static getDatafromStorage(){return et.DebugMode?JSON.parse(localStorage.getItem(Q+"ProfileDebug")||"{}"):JSON.parse(localStorage.getItem(Q+"Profile")||"{}")}}const vt={default:"Atma-SemiBold",english:"Atma-SemiBold",swahili:"Atma-SemiBold",wolof:"Atma-SemiBold",tajik:"Atma-SemiBold",marathi:"Atma-SemiBold",amharic:"Atma-SemiBold",punjabi:"Atma-SemiBold",tamil:"Atma-SemiBold",sepedi:"Atma-SemiBold",gujarati:"Atma-SemiBold",telugu:"Atma-SemiBold",tsonga:"Atma-SemiBold",malay:"Atma-SemiBold",ndebele:"Atma-SemiBold",venda:"Atma-SemiBold",siswati:"Atma-SemiBold",tswana:"Atma-SemiBold",thai:"Atma-SemiBold",fula:"Atma-SemiBold",farsi:"Atma-SemiBold",burmese:"Atma-SemiBold",bengali:"Atma-SemiBold",Azerbaijani:"Atma-SemiBold",Sesotho:"Atma-SemiBold",Georgian:"Atma-SemiBold",BrazilianPortuguese:"Atma-SemiBold",Somali:"Atma-SemiBold",Hausa:"Atma-SemiBold",Igbo:"Atma-SemiBold",HatianCreole:"Atma-SemiBold",Oromo:"Atma-SemiBold",Luganda:"Atma-SemiBold",Yoruba:"Atma-SemiBold",Khmer:"Atma-SemiBold",Javanese:"Atma-SemiBold",Urdu:"Atma-SemiBold",Kinyarwanda:"Atma-SemiBold",Shona:"Atma-SemiBold",Kurdish:"Atma-SemiBold",French:"Atma-SemiBold",isiXhosa:"Atma-SemiBold",Afrikaans:"Atma-SemiBold",Nepali:"Atma-SemiBold",Ukrainian:"Atma-SemiBold",Hindi:"Atma-SemiBold",Tagalog:"Atma-SemiBold",Vietnamese:"Atma-SemiBold",Pashto:"Atma-SemiBold",Twi:"Atma-SemiBold",Arabic:"Atma-SemiBold"};class wt{posX;posY;context;canvas;imagesLoaded=!1;pause_button_image;btnSizeAnimation;btnOriginalSize;orignalPos;constructor(t,e){this.posX=e.width-.09*e.height,this.posY=0,this.context=t,this.canvas=e,R({pause_button_image:"./assets/images/pause_v01.webp"},(t=>{this.pause_button_image=t.pause_button_image,this.imagesLoaded=!0})),this.btnSizeAnimation=.09,this.btnOriginalSize=this.btnSizeAnimation,this.orignalPos={x:this.posX,y:this.posY}}draw(){this.imagesLoaded&&(this.context.drawImage(this.pause_button_image,this.posX,this.posY,this.canvas.height*this.btnSizeAnimation,this.canvas.height*this.btnSizeAnimation),this.btnSizeAnimation<.09?this.btnSizeAnimation=this.btnSizeAnimation+25e-5:(this.posX=this.orignalPos.x,this.posY=this.orignalPos.y))}onClick(t,e){const i=X(t,e,this.posX,this.posY,this.canvas.height*this.btnOriginalSize,this.canvas.height*this.btnOriginalSize,!0);return i&&(this.btnSizeAnimation=.085,this.posX=this.posX+.9,this.posY=this.posY+.9),i}}class bt{handler;stoneDropCallbackHandler;loadPuzzleCallbackHandler;constructor(t){this.handler=t,this.stoneDropCallbackHandler=t.stoneDropCallbackHandler,this.loadPuzzleCallbackHandler=t.loadPuzzleCallbackHandler,document.addEventListener(st,this.handleStoneDroppedEvent,!1),document.addEventListener(it,this.handleLoadPuzzleEvent,!1)}handleStoneDroppedEvent=t=>{this.stoneDropCallbackHandler(t)};handleLoadPuzzleEvent=t=>{this.loadPuzzleCallbackHandler(t)};unregisterEventListener=()=>{document.removeEventListener(st,this.handleStoneDroppedEvent,!1),document.removeEventListener(it,this.handleLoadPuzzleEvent,!1)}}class St extends bt{context;canvas;activeIndicators;images;loadedImages;imagesLoaded=!1;constructor(t,e,i){super({stoneDropCallbackHandler:t=>this.handleStoneDrop(t),loadPuzzleCallbackHandler:t=>this.handleLoadPuzzle(t)}),this.context=t,this.canvas=e,this.activeIndicators=i,this.images={level_indicator:"./assets/images/levels_v01.webp",bar_empty:"./assets/images/bar_empty_v01.webp",bar_full:"./assets/images/bar_full_v01.webp"},R(this.images,(t=>{this.loadedImages=Object.assign({},t),this.imagesLoaded=!0}))}setIndicators(t){this.activeIndicators=t}addDropStoneEvent(){document.addEventListener("dropstone",(t=>{this.setIndicators(2)}))}draw(){if(this.imagesLoaded){this.context.drawImage(this.loadedImages.level_indicator,.15*this.canvas.width,0,.35*this.canvas.width,.09*this.canvas.height);for(var t=0;t<5;t++)this.context.drawImage(this.loadedImages.bar_empty,.35*this.canvas.width/7*(t+1)+.15*this.canvas.width,.09*this.canvas.height/2-.09*this.canvas.height/6,.35*this.canvas.width/10,.09*this.canvas.height/3);for(t=0;t<this.activeIndicators;t++)this.context.drawImage(this.loadedImages.bar_full,.35*this.canvas.width/7*(t+1)+.15*this.canvas.width,.09*this.canvas.height/2-.09*this.canvas.height/6,.35*this.canvas.width/10,.09*this.canvas.height/3)}}dispose(){this.unregisterEventListener()}handleStoneDrop(t){}handleLoadPuzzle(t){this.setIndicators(t.detail.counter)}}class yt extends bt{width;height;levelData;currentPromptText;currentPuzzleData;canavsElement;context;prompt_image;targetStones;rightToLeft;imagesLoaded=!1;audioPlayer;isStoneDropped=!1;droppedStones=0;droppedStoneCount=0;time=0;promptImageWidth=0;isAppForeground=!0;scale=1;isScalingUp=!0;scaleFactor=5e-4;promptImageHeight=0;promptPlayButton;constructor(t,e,i,s,n){super({stoneDropCallbackHandler:t=>this.handleStoneDrop(t),loadPuzzleCallbackHandler:t=>this.handleLoadPuzzle(t)}),this.width=t,this.height=e,this.levelData=s,this.rightToLeft=n,this.currentPromptText=i.prompt.promptText,this.currentPuzzleData=i,this.targetStones=this.currentPuzzleData.targetStones,this.canavsElement=document.getElementById("canvas"),this.context=this.canavsElement.getContext("2d"),this.audioPlayer=new Pt,this.audioPlayer.preloadPromptAudio(this.getPromptAudioUrl()),this.prompt_image=new Image,this.promptPlayButton=new Image,this.loadImages(),this.time=0,this.promptImageWidth=.65*this.width,this.promptImageHeight=.3*this.height,document.addEventListener(at,this.handleVisibilityChange,!1)}handleMouseDown=t=>{const e=document.getElementById("canvas");t.preventDefault();var i=e.getBoundingClientRect();const s=t.clientX-i.left,n=t.clientY-i.top;this.onClick(s,n)&&this.playSound()};getPromptAudioUrl=()=>j.getConvertedDevProdURL(this.currentPuzzleData.prompt.promptAudio);playSound=()=>{this.isAppForeground&&this.audioPlayer.playPromptAudio(j.getConvertedDevProdURL(this.currentPuzzleData.prompt.promptAudio))};onClick(t,e){return Math.sqrt(t-this.width/3)<12&&Math.sqrt(e-this.height/5.5)<10}setCurrrentPuzzleData(t){this.currentPuzzleData=t,this.currentPromptText=t.prompt.promptText,this.targetStones=this.currentPuzzleData.targetStones}drawRTLLang(){var t=this.width/2;const e=.28*this.height;var i=this.calculateFont();const s=this.promptImageWidth,n=this.promptImageHeight;if(this.context.font=`${i}px ${tt}, monospace`,"LetterInWord"==this.levelData.levelMeta.levelType)if(this.context.textAlign="left","Visible"==this.levelData.levelMeta.protoType){var a=this.currentPromptText.replace(new RegExp(this.currentPuzzleData.targetStones[0]),""),o=this.context.measureText(this.targetStones[0]).width,r=this.context.measureText(a).width,h=t+(o+r)/2-o;this.context.fillStyle="red",this.context.fillText(this.targetStones[0],h,e),this.context.fillStyle="black",this.context.fillText(a,h-r,e)}else this.context.drawImage(this.promptPlayButton,this.width/2.4,e/1.15,s/4,n/4);else if("Word"==this.levelData.levelMeta.levelType)if("Visible"==this.levelData.levelMeta.protoType){t-=.5*this.context.measureText(this.currentPromptText).width;for(let i=this.targetStones.length-1;i>=0;i--)this.droppedStones>i||null==this.droppedStones?(this.context.fillStyle="black",this.context.fillText(this.targetStones[i],t,e)):(this.context.fillStyle="red",this.context.fillText(this.targetStones[i],t,e)),t=t+this.context.measureText(this.targetStones[i]).width+5}else this.context.drawImage(this.promptPlayButton,this.width/2.4,e/1.15,s/4,n/4);else if("audioPlayerWord"==this.levelData.levelMeta.levelType){const t=1.25*(this.width-s),e=.33*(this.height-n);this.context.drawImage(this.promptPlayButton,t,e,s/4,n/4)}else"Visible"==this.levelData.levelMeta.protoType?(this.context.fillStyle="black",this.context.fillText(this.currentPromptText,t,e)):this.context.drawImage(this.promptPlayButton,this.width/2.4,e/1.15,s/4,n/4)}drawOthers(){const t=this.currentPromptText.split(""),e=(this.width,.28*this.height),i=this.promptImageWidth,s=this.promptImageHeight;var n=this.calculateFont();this.context.font=`${n}px ${tt}, monospace`;let a=this.width/2-this.context.measureText(this.currentPromptText).width/2,o=0;var r=this.currentPuzzleData.targetStones[0],h=this.currentPromptText.substring(0,this.currentPromptText.indexOf(r)),l=this.currentPromptText.substring(this.currentPromptText.indexOf(r)+r.length);if("LetterInWord"===this.levelData.levelMeta.levelType&&"Visible"==this.levelData.levelMeta.protoType){let t=0;this.context.textAlign="start",h.length>0&&(this.context.fillStyle="black",this.context.fillText(h,a,e),t+=this.context.measureText(h).width),r.length>0&&(this.context.fillStyle="red",this.context.fillText(r,a+t,e),t+=this.context.measureText(r).width),l.length>0&&(this.context.fillStyle="black",this.context.fillText(l,a+t,e),t+=this.context.measureText(l).width)}for(let n=0;n<t.length;n++)switch(this.levelData.levelMeta.levelType){case"LetterInWord":break;case"Word":if("Visible"==this.levelData.levelMeta.protoType){if(this.context.textAlign=0==n?"start":"center",this.targetStones.length!=this.currentPromptText.length){this.targetStones.length>n&&(this.context.fillStyle=this.droppedStoneCount>n||null==this.droppedStoneCount?"black":"red",this.context.fillText(this.targetStones[n],a,e),o=(this.context.measureText(this.targetStones[n]).width+this.context.measureText(this.targetStones[n+1]).width)/2,a+=o,0==n&&(a+=this.context.measureText(this.targetStones[n]).width/2));break}this.context.fillStyle=this.droppedStones>n||null==this.droppedStones?"black":"red",this.context.fillText(t[n],a,e),o=(this.context.measureText(t[n]).width+this.context.measureText(t[n+1]).width)/2,a+=o,0==n&&(a+=this.context.measureText(t[n]).width/2);break}this.context.drawImage(this.promptPlayButton,this.width/2.4,e/1.25,i/4,s/4);case"SoundWord":this.context.drawImage(this.promptPlayButton,this.width/2.4,e/1.25,i/4,s/4);break;default:if("Visible"==this.levelData.levelMeta.protoType){this.context.fillStyle="black",this.context.fillText(this.currentPromptText,this.width/2.1,e);break}this.context.drawImage(this.promptPlayButton,this.width/2.4,e/1.25,i/4,s/4)}}draw(t){if(this.updateScaling(),this.time=t<17?this.time+Math.floor(t):this.time+16,Math.floor(this.time)>=1910&&Math.floor(this.time)<=1926&&this.playSound(),!this.isStoneDropped){const t=this.promptImageWidth*this.scale,e=this.promptImageHeight*this.scale,i=(this.width-t)/2,s=(this.height-e)/5;this.context.drawImage(this.prompt_image,i,s,t,e),this.context.fillStyle="black",this.rightToLeft?this.drawRTLLang():this.drawOthers()}}handleStoneDrop(t){this.isStoneDropped=!0}handleLoadPuzzle(t){this.droppedStones=0,this.droppedStoneCount=0,this.currentPuzzleData=this.levelData.puzzles[t.detail.counter],this.currentPromptText=this.currentPuzzleData.prompt.promptText,this.targetStones=this.currentPuzzleData.targetStones,this.audioPlayer.preloadPromptAudio(this.getPromptAudioUrl()),this.isStoneDropped=!1,this.time=0}dispose(){document.removeEventListener(at,this.handleVisibilityChange,!1),this.unregisterEventListener()}droppedStoneIndex(t){this.droppedStones=t,this.droppedStoneCount++}calculateFont(){return this.promptImageWidth/this.currentPromptText.length>35?35:.65*this.width/this.currentPromptText.length}updateScaling(){this.isScalingUp?(this.scale+=this.scaleFactor,this.scale>=1.05&&(this.isScalingUp=!1)):(this.scale-=this.scaleFactor,this.scale<=1&&(this.scale=1,this.isScalingUp=!0))}handleVisibilityChange=()=>{"hidden"==document.visibilityState&&(this.audioPlayer.stopAllAudios(),this.isAppForeground=!1),"visible"==document.visibilityState&&(this.isAppForeground=!0)};async loadImages(){const t=this.loadImage(this.prompt_image,"./assets/images/promptTextBg.webp"),e=this.loadImage(this.promptPlayButton,"./assets/images/promptPlayButton.webp");await Promise.all([t,e]),this.imagesLoaded=!0}loadImage(t,e){return new Promise(((i,s)=>{t.onload=()=>{i()},t.src=e,t.onerror=t=>{s(t)}}))}}class It extends bt{context;canvas;currentPuzzleData;targetStones;stonePos;pickedStone;foilStones=new Array;answer="";puzzleNumber;levelData;correctAnswer;puzzleStartTime;showTutorial=null==ft.getDatafromStorage().length;correctStoneAudio;tutorial;correctTargetStone;stonebg;audioPlayer;feedbackAudios;timerTickingInstance;isGamePaused=!1;constructor(t,e,i,s,n,a){super({stoneDropCallbackHandler:t=>this.handleStoneDrop(t),loadPuzzleCallbackHandler:t=>this.handleLoadPuzzle(t)}),this.context=t,this.canvas=e,this.puzzleNumber=i,this.levelData=s,this.setTargetStone(this.puzzleNumber),this.initializeStonePos(),this.correctStoneAudio=new Audio("assets/audios/CorrectStoneFinal.mp3"),this.correctStoneAudio.loop=!1,this.feedbackAudios=this.convertFeedBackAudiosToList(n),this.puzzleStartTime=new Date,this.tutorial=new xt(t,e.width,e.height,i),this.stonebg=new Image,this.stonebg.src="./assets/images/stone_pink.webp",this.audioPlayer=new Pt,this.stonebg.onload=t=>{this.createStones(this.stonebg)},this.audioPlayer=new Pt,this.timerTickingInstance=a,document.addEventListener(at,this.handleVisibilityChange,!1)}createStones(t){const i=this.getFoilStones();for(let s=0;s<i.length;s++)i[s]==this.correctTargetStone&&this.tutorial.updateTargetStonePositions(this.stonePos[s]),this.foilStones.push(new e(this.context,this.canvas.width,this.canvas.height,i[s],this.stonePos[s][0],this.stonePos[s][1],t,this.timerTickingInstance,s==i.length-1?this.tutorial:null))}draw(t){this.foilStones.length>0&&(this.foilStones.forEach((e=>{e&&void 0!==e.frame&&e.draw(t)})),this.foilStones[this.foilStones.length-1].frame>=100&&!this.isGamePaused&&this.timerTickingInstance.update(t))}drawWordPuzzleLetters(t,e,i){for(let s=0;s<this.foilStones.length;s++)this.foilStones[s]&&e(s)&&this.foilStones[s].draw(t,Object.keys(i).length>1&&void 0!==i[s]);const s=this.foilStones[this.foilStones.length-1];s&&void 0!==s.frame&&s.frame>=100&&!this.isGamePaused&&this.timerTickingInstance.update(t)}initializeStonePos(){let t=32;this.stonePos=[[this.canvas.width/5-t,this.canvas.height/1.9-t],[this.canvas.width/2-t,this.canvas.height/1.15-t],[this.canvas.width/3.5+this.canvas.width/2-t,this.canvas.height/1.2-t],[this.canvas.width/4-t,this.canvas.height/1.28-t],[this.canvas.width/7-t,this.canvas.height/1.5-t],[this.canvas.width/2.3+this.canvas.width/2.1-t,this.canvas.height/1.9-t],[this.canvas.width/2.3+this.canvas.width/2.1-t,this.canvas.height/1.42-t],[this.canvas.width/6-t,this.canvas.height/1.1-t]],this.stonePos=this.stonePos.sort((()=>Math.random()-.5))}setTargetStone(t){this.currentPuzzleData=this.levelData.puzzles[t],this.targetStones=[...this.currentPuzzleData.targetStones],this.correctTargetStone=this.targetStones.join("")}handleStoneDrop(t){this.foilStones=[]}handleLoadPuzzle(t){this.foilStones=[],this.tutorial.setPuzzleNumber(t.detail.counter),this.puzzleNumber=t.detail.counter,this.setTargetStone(this.puzzleNumber),this.initializeStonePos(),this.createStones(this.stonebg)}dispose(){document.removeEventListener(at,this.handleVisibilityChange,!1),this.unregisterEventListener()}isStoneLetterDropCorrect(t,e,i=!1){const s=i?t==this.correctTargetStone.substring(0,t.length):t==this.correctTargetStone;return this.processLetterDropFeedbackAudio(e,s,i,t),s}processLetterDropFeedbackAudio(t,e,i,s){if(e){(i?s===this.getCorrectTargetStone():e)?this.playCorrectAnswerFeedbackSound(t):this.audioPlayer.playFeedbackAudios(!1,l,c(2))}else this.audioPlayer.playFeedbackAudios(!1,l,"./assets/audios/MonsterSpit.mp3",Math.round(Math.random())>0?"./assets/audios/Disapointed-05.mp3":null)}getCorrectTargetStone(){return this.correctTargetStone}getFoilStones(){this.currentPuzzleData.targetStones.forEach((t=>{const e=this.currentPuzzleData.foilStones.indexOf(t);-1!==e&&this.currentPuzzleData.foilStones.splice(e,1)}));const t=this.currentPuzzleData.targetStones.length+this.currentPuzzleData.foilStones.length;if(t>8){const e=t-8;this.currentPuzzleData.foilStones.splice(0,e)}return this.currentPuzzleData.targetStones.forEach((t=>{this.currentPuzzleData.foilStones.push(t)})),this.currentPuzzleData.foilStones.sort((()=>Math.random()-.5))}handleVisibilityChange=()=>{this.audioPlayer.stopAllAudios(),this.correctStoneAudio.pause()};convertFeedBackAudiosToList(t){return[t.fantastic,t.great,t.amazing]}setGamePause(t){this.isGamePaused=t}playCorrectAnswerFeedbackSound(t){const e=j.getRandomNumber(1,3).toString();this.audioPlayer.playFeedbackAudios(!1,l,c(e),"assets/audios/PointsAdd.wav",j.getConvertedDevProdURL(this.feedbackAudios[t])),this.correctStoneAudio.play()}resetStonePosition(t,e,i){const s=e,n=i;if(s&&n&&s.text&&"number"==typeof n.origx&&"number"==typeof n.origy){const e=50,i=t/2;s.x=s.text.length<=3&&n.origx<e&&n.origx<i?n.origx+25:n.origx,s.y=n.origy}return s}computeCursorDistance(t,e,i){return Math.sqrt((t-i.x)**2+(e-i.y)**2)}handlePickStoneUp(t,e){let i=null,s=0;for(let n of this.foilStones){if(this.computeCursorDistance(t,e,n)<=40){i=n,i.foilStoneIndex=s;break}s++}return i}handleHoveringToAnotherStone(t,e,i){let s=null,n=0;for(let a of this.foilStones){if(this.computeCursorDistance(t,e,a)<=40&&i(a.text,n)){s=a,s.foilStoneIndex=n;break}n++}return s}handleMovingStoneLetter(t,e,i){const s=t,n=this.canvas.getBoundingClientRect();return s.x=e-n.left,s.y=i-n.top,s}}class xt{width;height;context;tutorialImg;imagesLoaded=!1;targetStonePositions;startx;starty;endx;endy;endTutorial=!1;puzzleNumber;playMnstrClkTtrlAnim=!0;totalTime=0;monsterStoneDifference=0;x;y;dx;dy;absdx;absdy;startRipple=!1;drawRipple;constructor(t,e,i,s){this.width=e,this.height=i,this.context=t,this.startx=0,this.starty=0,this.endx=this.width/2,this.endy=this.height/2,this.puzzleNumber=s>=0?s:null,this.tutorialImg=new Image,this.tutorialImg.src="./assets/images/tutorial_hand.webp",this.drawRipple=function(t){const e=t;if(!e)throw new Error("Canvas context is null");let i=0,s=0,n=10,a=10;return function(t,o,r){r&&(n=0,a=0),i=t,s=o,e.beginPath(),e.arc(i,s,n,0,2*Math.PI),e.strokeStyle="white",e.lineWidth=2,e.stroke(),e.closePath(),e.beginPath(),e.arc(i,s,a,0,2*Math.PI),e.strokeStyle="white",e.lineWidth=2,e.stroke(),e.closePath(),n+=.5,a+=.5,(n>=60||a>=60)&&(n=10,a=10)}}(this.context),this.tutorialImg.onload=()=>{this.imagesLoaded=!0}}updateTargetStonePositions(t){this.startx=t[0]-22,this.starty=t[1]-50,this.monsterStoneDifference=Math.sqrt((this.startx-this.endx)*(this.startx-this.endx)+(this.starty-this.endy)*(this.starty-this.endy)),this.animateImage()}isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}setTutorialEnd(t){this.endTutorial=t}animateImage(){this.x=this.startx,this.y=this.starty,this.dx=(this.endx-this.startx)/5e3,this.dy=(this.endy-this.starty)/5e3,this.absdx=this.isMobile()?3*Math.abs(this.dx):Math.abs(this.dx),this.absdy=this.isMobile()?3*Math.abs(this.dy):Math.abs(this.dy),this.setTutorialEnd(!1)}draw(t,e,i){if(this.imagesLoaded&&!this.endTutorial&&this.shouldPlayTutorial()){this.x=this.dx>=0?this.x+this.absdx*t:this.x-this.absdx*t,this.y=this.dy>=0?this.y+this.absdy*t:this.y-this.absdy*t;const s=this.x-this.endx+this.absdx,n=this.y-this.endy+this.absdy;let a=100*Math.sqrt(s*s+n*n)/this.monsterStoneDifference;if(a<15)a>1?this.createHandScaleAnimation(t,this.endx,this.endy+30,!0):(this.x=this.startx,this.y=this.starty);else if(a>80)this.createHandScaleAnimation(t,this.startx+15,this.starty+10,!1);else{let t=this.context.globalAlpha;this.context.globalAlpha=.4,this.context.drawImage(e,this.x,this.y+20,i,i),this.context.globalAlpha=t,this.context.drawImage(this.tutorialImg,this.x+15,this.y+10)}}}createHandScaleAnimation(t,e,i,s){this.totalTime+=Math.floor(t);const n=this.sinusoidalInterpolation(this.totalTime,1,1.5,500),a=this.tutorialImg.width*n,o=this.tutorialImg.height*n;this.context.drawImage(this.tutorialImg,e,i,a,o),!s&&this.drawRipple(e+.02*this.width,i+this.tutorialImg.height/2,!1)}sinusoidalInterpolation(t,e,i,s){const n=(i-e)/2,a=Math.PI/s;return e+n*Math.sin(a*t)}clickOnMonsterTutorial(t){if(this.shouldPlayMonsterClickTutorialAnimation()){const e=2e3,i=this.height/1.9+this.tutorialImg.height/.8,s=this.height/1.9+this.tutorialImg.height/.8-this.tutorialImg.height;let n;const a=this.endx;this.totalTime<e/2?(n=s+this.totalTime/(e/2)*(i-s),this.drawRipple(a,this.height/1.9+this.tutorialImg.height/1.5,!0)):(n=i-(this.totalTime-e/2)/(e/2)*(i-s),this.drawRipple(a,this.height/1.9+this.tutorialImg.height/1.2+this.tutorialImg.height)),this.context.drawImage(this.tutorialImg,a,n,this.tutorialImg.width,this.tutorialImg.height),n<=s&&(this.totalTime=0),this.totalTime+=t}}shouldPlayTutorial(){return 0==j.levelNum}shouldPlayMonsterClickTutorialAnimation(){return 0==j.levelNum}setPuzzleNumber(t){this.puzzleNumber=t}setPlayMonsterClickAnimation(t){this.playMnstrClkTtrlAnim=t}}class Tt extends bt{zindex;width;height;image;frameX;frameY;maxFrame;x;y;fps;countFrame;frameInterval;frameTimer;canvasStack;canavsElement;context;game;images;loadedImages;imagesLoaded=!1;monsterPhase;constructor(t,e,i){super({stoneDropCallbackHandler:t=>this.handleStoneDrop(t),loadPuzzleCallbackHandler:t=>this.handleLoadPuzzle(t)}),this.game=t,this.monsterPhase=e,this.width=this.game.width,this.height=this.game.height,this.canavsElement=document.getElementById("canvas"),this.context=this.canavsElement.getContext("2d"),this.image=document.getElementById("monster"),this.frameX=0,this.frameY=0,this.maxFrame=6,this.x=this.game.width/2-.243*this.game.width,this.y=this.game.width/3,this.fps=10,this.countFrame=0,this.frameInterval=1e3/this.fps,this.frameTimer=0,this.images={eatImg:"./assets/images/eat1"+this.monsterPhase+".png",idleImg:"./assets/images/idle1"+this.monsterPhase+".png",spitImg:"./assets/images/spit1"+this.monsterPhase+".png",dragImg:"./assets/images/drag1"+this.monsterPhase+".png"},R(this.images,(t=>{this.loadedImages=Object.assign({},t),this.changeToIdleAnimation(),this.imagesLoaded=!0,i&&i()}))}update(t){this.frameTimer>=this.frameInterval?(this.frameTimer=0,this.frameX<this.maxFrame?this.frameX++:this.frameX=0):this.frameTimer+=t,this.draw()}draw(){this.imagesLoaded&&this.context.drawImage(this.image,770*this.frameX,1386*this.frameY,768,1386,.5*this.x,.1*this.y,this.width/2*1.5,this.height/1.5*1.5)}changeImage(t){this.image.src=t}changeToDragAnimation(){this.maxFrame=6,this.image=this.loadedImages.dragImg}changeToEatAnimation(){this.maxFrame=12,this.image=this.loadedImages.eatImg}changeToIdleAnimation(){this.maxFrame=6,this.image=this.loadedImages.idleImg}changeToSpitAnimation(){this.maxFrame=12,this.image=this.loadedImages.spitImg}handleStoneDrop(t){t.detail.isCorrect?this.changeToEatAnimation():this.changeToSpitAnimation()}handleLoadPuzzle(t){this.changeToIdleAnimation()}dispose(){this.unregisterEventListener()}onClick(t,e){if(Math.sqrt((t-this.x-this.width/4)*(t-this.x-this.width/4)+(e-this.y-this.height/2.2)*(e-this.y-this.height/2.2))<=100)return!0}}class Ct extends bt{width;height;timerWidth;timerHeight;widthToClear;timer;isTimerStarted;isTimerEnded;isTimerRunningOut;canavsElement;context;timer_full;pauseButtonClicked;images;loadedImages;callback;imagesLoaded=!1;startMyTimer=!0;isMyTimerOver=!1;isStoneDropped=!1;audioPlayer;playLevelEndAudioOnce=!0;constructor(t,e,i){super({stoneDropCallbackHandler:t=>this.handleStoneDrop(t),loadPuzzleCallbackHandler:t=>this.handleLoadPuzzle(t)}),this.width=t,this.height=e,this.widthToClear=this.width/3.4,this.timerHeight=112,this.timerWidth=888,this.callback=i,this.canavsElement=document.getElementById("canvas"),this.context=this.canavsElement.getContext("2d"),this.timer=0,this.isTimerStarted=!1,this.isTimerEnded=!1,this.isTimerRunningOut=!1,this.audioPlayer=new Pt,this.playLevelEndAudioOnce=!0,this.images={timer_empty:"./assets/images/timer_empty.webp",rotating_clock:"./assets/images/timer.webp",timer_full:"./assets/images/timer_full.png"},R(this.images,(t=>{this.loadedImages=Object.assign({},t),this.imagesLoaded=!0}))}startTimer(){this.readyTimer(),this.startMyTimer=!0,this.isMyTimerOver=!1}readyTimer(){this.timer=0}update(t){this.startMyTimer&&!this.isStoneDropped&&(this.timer+=.008*t),40!=Math.floor(.87*this.width-.87*this.width*this.timer*.01)||this.isMyTimerOver||(this.playLevelEndAudioOnce&&this.audioPlayer.playAudio("./assets/audios/timeout.mp3"),this.playLevelEndAudioOnce=!1),.87*this.width-.87*this.width*this.timer*.01<0&&!this.isMyTimerOver&&(this.isMyTimerOver=!0,this.callback(!0))}draw(){this.imagesLoaded&&(this.context.drawImage(this.loadedImages.timer_empty,0,.1*this.height,this.width,.05*this.height),this.context.drawImage(this.loadedImages.rotating_clock,0,.09*this.height,.14*this.width,.065*this.height),this.context.drawImage(this.loadedImages.timer_full,0,0,this.timerWidth-this.timerWidth*this.timer*.01,this.timerHeight,.14*this.width,.099*this.height,.87*this.width-.87*this.width*this.timer*.01,.05*this.height))}handleStoneDrop(t){this.isStoneDropped=!0}handleLoadPuzzle(t){this.playLevelEndAudioOnce=!0,this.isStoneDropped=!1,this.startTimer()}dispose(){this.unregisterEventListener()}}class Lt{feedbackTextElement;hideTimeoutId;constructor(){this.feedbackTextElement=document.getElementById("feedback-text"),this.hideTimeoutId=null,this.initialize()}initialize(){this.isFeedbackElementAvailable()}isFeedbackElementAvailable(){return!!this.feedbackTextElement}wrapText(t){this.isFeedbackElementAvailable()&&(this.feedbackTextElement.textContent=t,V(!1,this.feedbackTextElement),this.setHideTimeout())}setHideTimeout(){this.hideTimeoutId&&clearTimeout(this.hideTimeoutId),this.hideTimeoutId=window.setTimeout((()=>{V(!0,this.feedbackTextElement),this.hideTimeoutId=null}),4e3)}}class Pt{audioContext;sourceNode;audioQueue;promptAudioBuffer;clickSoundBuffer;static audioBuffers=new Map;audioSourcs=[];isClickSoundLoaded;constructor(){this.audioContext=Et.getAudioContext(),this.sourceNode=null,this.audioQueue=[],this.clickSoundBuffer=null,this.isClickSoundLoaded=!1}async playButtonClickSound(){const t="./assets/audios/ButtonClick.mp3";if(!this.isClickSoundLoaded)try{this.clickSoundBuffer=await this.loadAndDecodeAudio(t),Pt.audioBuffers.set(t,this.clickSoundBuffer),this.isClickSoundLoaded=!0}catch(t){return void console.error("Error loading or decoding click sound:",t)}if(this.clickSoundBuffer){const t=this.audioContext.createBufferSource();t.buffer=this.clickSoundBuffer,t.connect(this.audioContext.destination),t.start()}else console.error("Click sound buffer is not available.")}async loadAndDecodeAudio(t){return new Promise((async(e,i)=>{try{const i=await fetch(t),s=await i.arrayBuffer();e(await this.audioContext.decodeAudioData(s))}catch(t){console.error("Error loading or decoding audio:",t),i(t)}}))}async preloadPromptAudio(t){const e=await this.loadAndDecodeAudio(t);e&&(this.promptAudioBuffer=e)}async preloadGameAudio(t){if(Pt.audioBuffers.has(t))return;const e=await this.loadAndDecodeAudio(t);e&&Pt.audioBuffers.set(t,e)}playAudio(t){const e=Pt.audioBuffers.get(t);if(e){const t=this.audioContext.createBufferSource();t.buffer=e,t.connect(this.audioContext.destination),this.audioSourcs.push(t),t.start()}}playFeedbackAudios=(t=!1,...e)=>{e.length>0&&(this.audioQueue=e,this.playFetch(0,t))};playPromptAudio=t=>{if(this.promptAudioBuffer){const t=this.audioContext.createBufferSource();t.buffer=this.promptAudioBuffer,t.connect(this.audioContext.destination),this.audioSourcs.push(t),t.start()}};stopFeedbackAudio=()=>{this.sourceNode&&(this.sourceNode.stop(),this.sourceNode=null),this.audioQueue=[]};stopAllAudios=()=>{this.sourceNode&&(this.sourceNode.stop(),this.sourceNode=null),this.audioQueue=[],this.audioSourcs.forEach((t=>{t.stop()})),this.audioSourcs=[]};playFetch=(t,e)=>{t>=this.audioQueue.length?this.stopFeedbackAudio():this.audioQueue[t]&&fetch(this.audioQueue[t]).then((t=>t.arrayBuffer())).then((i=>{this.audioContext?.decodeAudioData(i,(i=>{this.sourceNode=this.audioContext?.createBufferSource(),this.sourceNode.buffer=i,this.sourceNode.connect(this.audioContext?.destination),this.sourceNode.loop=e,this.sourceNode.onended=()=>this.handleAudioEnded(t,e),this.sourceNode.start()}))}))};handleAudioEnded=(t,e)=>{this.sourceNode&&(this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.disconnect(),this.sourceNode=null),this.playFetch(t+1,e)}}class Et{static instance=null;static getAudioContext(){return Et.instance||(Et.instance=new(window.AudioContext||window.webkitAudioContext)),Et.instance}}class zt{ctx;particles;mouse;isDiamond;constructor(t){this.ctx=t.getContext("2d"),this.particles=[],this.mouse={x:void 0,y:void 0},this.isDiamond=!1}init(){this.draw()}draw(){this.drawTrail();let t=[];for(let e=0;e<this.particles.length;e++)this.particles[e].time<=this.particles[e].ttl&&t.push(this.particles[e]);this.particles=t}drawTrail(){for(let t=0;t<this.particles.length;t++)this.particles[t].update(),this.isDiamond=!this.isDiamond,this.particles[t].draw(this.isDiamond)}addTrailParticlesOnMove(t,e){this.mouse.x=t,this.mouse.y=e,this.particles.push(new kt(this.ctx,this.mouse))}resetParticles(){this.mouse.x=void 0,this.mouse.y=void 0}}class kt{ctx;start;end;size;style;time;ttl;x;y;rgb;hyp;starX;starY;starAngle;constructor(t,e){const i=this.determineValueByScreenWidth(30,15),s=this.determineValueByScreenWidth(30,15),n=this.determineValueByScreenWidth(3,.5),a=this.determineValueByScreenWidth(2,.5);this.ctx=t,this.rgb=["rgb(255,255,255)","rgb(249,217,170)","rgb(244,182,81)","rgb(244,159,34)"],this.start={x:e.x+this.getRandomInt(-i,i),y:e.y+this.getRandomInt(-s,s),size:this.determineValueByScreenWidth(3,2)},this.end={x:this.start.x+this.getRandomInt(-n,n),y:this.start.y+this.getRandomInt(-a,a)},this.x=this.start.x,this.y=this.start.y,this.size=this.start.size,this.style=this.rgb[this.getRandomInt(0,this.rgb.length-1)],this.time=0,this.ttl=75,this.hyp=0,this.starX=0,this.starY=0,this.starAngle=0}determineValueByScreenWidth(t,e){return window.screen.width>768?t:e}update(){if(this.time<=this.ttl){const t=1-(this.ttl-this.time)/this.ttl;this.size=this.start.size*(1-this.easeOutQuart(t)),this.x=this.x+.01*(this.end.x-this.x),this.y=this.y+.01*(this.end.y-this.y)}this.time++}draw(t){t?this.starParticle():this.circleParticle()}circleParticle(){this.ctx.fillStyle=this.style,this.ctx.beginPath(),this.ctx.arc(this.x,this.y,this.size,0,2*Math.PI),this.ctx.closePath(),this.ctx.fill()}starParticle(){this.ctx.fillStyle=this.style,this.ctx.beginPath(),this.ctx.moveTo(this.x,this.y-this.size),this.ctx.lineTo(this.x+this.size,this.y),this.ctx.lineTo(this.x,this.y+this.size),this.ctx.lineTo(this.x-this.size,this.y),this.ctx.closePath(),this.ctx.fill()}getRandomInt(t,e){return Math.round(Math.random()*(e-t))+t}easeOutQuart(t){return 1-Math.pow(1-t,4)}}class At{posX;posY;context;canvas;imagesLoaded=!1;close_button_image;btnSizeAnimation;btnOriginalSize;orignalPos;constructor(t,e,i,s){this.posX=i,this.posY=s,this.context=t,this.canvas=e,R({close_button_image:"./assets/images/map_btn.webp"},(t=>{this.close_button_image=t.close_button_image,this.imagesLoaded=!0})),this.btnSizeAnimation=.19,this.btnOriginalSize=this.btnSizeAnimation,this.orignalPos={x:i,y:s}}draw(){this.imagesLoaded&&(this.context.drawImage(this.close_button_image,this.posX,this.posY,this.canvas.width*this.btnSizeAnimation,this.canvas.width*this.btnSizeAnimation),this.btnSizeAnimation<.19?this.btnSizeAnimation=this.btnSizeAnimation+5e-4:(this.posX=this.orignalPos.x,this.posY=this.orignalPos.y))}onClick(t,e){const i=X(t,e,this.posX,this.posY,this.canvas.width*this.btnOriginalSize,this.canvas.width*this.btnOriginalSize,!0);return i&&(this.btnSizeAnimation=.18,this.posX=this.posX+1,this.posY=this.posY+1),i}}class _t{posX;posY;context;canvas;imagesLoaded=!1;cancel_button_image;btnSizeAnimation;btnOriginalSize;orignalPos;constructor(t,e){this.posX=.1*e.width+.15*e.width/2,this.posY=.2*e.height,this.context=t,this.canvas=e,R({cancel_button_image:k},(t=>{this.cancel_button_image=t.cancel_button_image,this.imagesLoaded=!0})),this.btnSizeAnimation=.15,this.btnOriginalSize=this.btnSizeAnimation,this.orignalPos={x:this.posX,y:this.posY}}draw(){this.imagesLoaded&&(this.context.drawImage(this.cancel_button_image,this.posX,this.posY,this.canvas.width*this.btnSizeAnimation,this.canvas.width*this.btnSizeAnimation),this.btnSizeAnimation<.15?this.btnSizeAnimation=this.btnSizeAnimation+5e-4:(this.posX=this.orignalPos.x,this.posY=this.orignalPos.y))}onClick(t,e){const i=X(t,e,this.posX,this.posY,this.canvas.width*this.btnOriginalSize,this.canvas.width*this.btnOriginalSize,!0);return i&&(this.btnSizeAnimation=.14,this.posX=this.posX+1,this.posY=this.posY+1),i}}class Dt{posX;posY;context;width;height;imagesLoaded=!1;next_button_image;btnSizeAnimation;btnOriginalSize;orignalPos;constructor(t,e,i,s,n){this.posX=s,this.posY=n,this.context=t,this.width=e,this.height=i,R({next_button_image:z},(t=>{this.next_button_image=t.next_button_image,this.imagesLoaded=!0})),this.btnSizeAnimation=.19,this.btnOriginalSize=this.btnSizeAnimation,this.orignalPos={x:this.posX,y:this.posY}}draw(){this.imagesLoaded&&(this.context.drawImage(this.next_button_image,this.posX,this.posY,this.width*this.btnSizeAnimation,this.width*this.btnSizeAnimation),this.btnSizeAnimation<.19?this.btnSizeAnimation=this.btnSizeAnimation+5e-4:(this.posX=this.orignalPos.x,this.posY=this.orignalPos.y))}onClick(t,e){const i=X(t,e,this.posX,this.posY,this.width*this.btnOriginalSize,this.width*this.btnOriginalSize,!0);return i&&(this.btnSizeAnimation=.18,this.posX=this.posX+1,this.posY=this.posY+1),i}}class Bt{posX;posY;context;canvas;imagesLoaded=!1;no_button_image;btnSizeAnimation;btnOriginalSize;orignalPos;constructor(t,e,i,s){this.posX=i+5,this.posY=s+10,this.context=t,this.canvas=e,R({no_button_image:k},(t=>{this.no_button_image=t.no_button_image,this.imagesLoaded=!0})),this.btnSizeAnimation=.18,this.btnOriginalSize=this.btnSizeAnimation,this.orignalPos={x:this.posX,y:this.posY}}draw(){this.imagesLoaded&&(this.context.drawImage(this.no_button_image,this.posX,this.posY,this.canvas.width*this.btnSizeAnimation,this.canvas.width*this.btnSizeAnimation),this.btnSizeAnimation<.18?this.btnSizeAnimation=this.btnSizeAnimation+5e-4:(this.posX=this.orignalPos.x,this.posY=this.orignalPos.y))}onClick(t,e){const i=X(t,e,this.posX,this.posY,this.canvas.width*this.btnOriginalSize,this.canvas.width*this.btnOriginalSize,!0);return i&&(this.btnSizeAnimation=.17,this.posX=this.posX+1,this.posY=this.posY+1),i}}class Mt{posX;posY;context;canvas;imagesLoaded=!1;retry_button_image;btnSizeAnimation;btnOriginalSize;orignalPos;constructor(t,e,i,s){this.posX=i,this.posY=s,this.context=t,this.canvas=e,R({retry_button_image:"./assets/images/retry_btn.webp"},(t=>{this.retry_button_image=t.retry_button_image,this.imagesLoaded=!0})),this.btnSizeAnimation=.19,this.btnOriginalSize=this.btnSizeAnimation,this.orignalPos={x:i,y:s}}draw(){this.imagesLoaded&&(this.context.drawImage(this.retry_button_image,this.posX,this.posY,this.canvas.width*this.btnSizeAnimation,this.canvas.width*this.btnSizeAnimation),this.btnSizeAnimation<.19?this.btnSizeAnimation=this.btnSizeAnimation+5e-4:(this.posX=this.orignalPos.x,this.posY=this.orignalPos.y))}onClick(t,e){const i=X(t,e,this.posX,this.posY,this.canvas.width*this.btnOriginalSize,this.canvas.width*this.btnOriginalSize,!0);return i&&(this.btnSizeAnimation=.18,this.posX=this.posX+1,this.posY=this.posY+1),i}}class Ot{posX;posY;context;canvas;imagesLoaded=!1;yes_button_image;btnSizeAnimation;btnOriginalSize;orignalPos;constructor(t,e,i,s){this.posX=i-5,this.posY=s,this.context=t,this.canvas=e,R({yes_button_image:"./assets/images/confirm_btn.webp"},(t=>{this.yes_button_image=t.yes_button_image,this.imagesLoaded=!0})),this.btnSizeAnimation=.205,this.btnOriginalSize=this.btnSizeAnimation,this.orignalPos={x:this.posX,y:this.posY}}draw(){this.imagesLoaded&&(this.context.drawImage(this.yes_button_image,this.posX,this.posY,this.canvas.width*this.btnSizeAnimation,this.canvas.width*this.btnSizeAnimation),this.btnSizeAnimation<.205?this.btnSizeAnimation=this.btnSizeAnimation+5e-4:(this.posX=this.orignalPos.x,this.posY=this.orignalPos.y))}onClick(t,e){const i=X(t,e,this.posX,this.posY,this.canvas.width*this.btnOriginalSize,this.canvas.width*this.btnOriginalSize,!0);return i&&(this.btnSizeAnimation=.19,this.posX=this.posX+1,this.posY=this.posY+1),i}}class Nt{context;levelData;posX;posY;originalPosX;originalPosY;size;radiusOffSet;bloonSize;btnSize;lockSize;textFontSize;constructor(t,e,i){this.context=e,this.levelData=i,this.posX=this.levelData.x,this.posY=this.levelData.y,this.originalPosX=this.posX,this.originalPosY=this.posY,this.size=t.height/5,this.radiusOffSet=t.height/20,this.bloonSize=this.isLevelSpecial(this.size),this.btnSize=this.bloonSize,this.lockSize=t.height/13,this.textFontSize=this.size/6}isSpecialLevel(t){return N.includes(t)}isLevelSpecial(t){return this.levelData?.isSpecial?.9*t:t}draw(t,e,i,s){this.context.drawImage(this.levelData?.balloonImg,this.posX,this.posY,this.btnSize,this.btnSize),this.context.fillStyle="white",this.context.font=this.textFontSize+`px ${tt}, monospace`,this.context.textAlign="center",this.context.fillText(`${this.levelData.index+t}`,this.levelData.x+this.size/3.5,this.levelData.y+this.size/3),this.context.font=this.textFontSize-this.size/30+`px ${tt}, monospace`,this.btnSize<this.bloonSize?this.btnSize=this.btnSize+.5:(this.btnSize=this.bloonSize,this.posX=this.levelData.x,this.posY=this.levelData.y),this.drawIcons(t,e,i,s)}applyPulseEffect(){const t=.7,e=Date.now()%1500/1500,i=e<=t,s=i?e/t:(e-t)/(i?t:.30000000000000004),n=i?15*s:15+45*s,a=i?.5*(1-s):0;if(a<=0)return;const{x:o,y:r,radius:h}=this.levelData?.isSpecial?{x:3,y:2.5,radius:2.2}:{x:3.4,y:3.8,radius:3.2},l=this.posX+this.btnSize/o,c=this.posY+this.btnSize/r,d=this.btnSize/h+n;this.context.save(),this.context.beginPath(),this.context.arc(l,c,d,0,2*Math.PI),this.context.fillStyle=`rgba(255, 255, 255, ${a})`,this.context.fill(),this.context.restore()}drawIcons(t,e,i,s){const n=this.levelData.index;if(et.DebugMode||n+t-1>e+1&&this.drawLock(),i.length&&n+t<=s)for(let e=0;e<i.length;e++)if(n-1+t===parseInt(i[e].levelNumber)){this.checkStars(i[e].starCount);break}}drawLock(){this.context.drawImage(this.levelData?.lockImg,this.levelData.x,this.levelData.y,this.lockSize,this.lockSize)}checkStars(t){const e=this.levelData.x,i=this.levelData.y,s=this.size;t>=1&&this.drawStar(e,i-.01*s),t>1&&this.drawStar(e+s/2.5,i-.01*s),3===t&&this.drawStar(e+s/5,i-.1*s)}drawStar(t,e){this.context.drawImage(this.levelData?.starImg,t,e,this.size/5,this.size/5)}onClick(t,e,i,s,n){Math.sqrt((t-this.levelData.x-this.radiusOffSet)*(t-this.levelData.x-this.radiusOffSet)+(e-this.levelData.y-this.radiusOffSet)*(e-this.levelData.y-this.radiusOffSet))<45&&(et.DebugMode||this.levelData.index+i<=s)&&(this.btnSize=this.bloonSize-4,this.posX=this.originalPosX+.5,this.posY=this.originalPosY+1,n(this.levelData.index))}}class Ft{canvas;context;yesButton;noButton;imagesLoaded=!1;pop_up_image;yesCallback;noCallback;audioPlayer;constructor(t,e,i){this.canvas=t,this.yesCallback=e,this.noCallback=i,this.context=this.canvas.getContext("2d"),this.audioPlayer=new Pt,this.yesButton=new Ot(this.context,this.canvas,.55*this.canvas.width,.2*this.canvas.height+.4*this.canvas.width-.15*this.canvas.width/2),this.noButton=new Bt(this.context,this.canvas,.25*this.canvas.width,.2*this.canvas.height+.4*this.canvas.width-.15*this.canvas.width/2),R({pop_up_image:A},(t=>{this.pop_up_image=t.pop_up_image,this.imagesLoaded=!0}))}addListner=()=>{this.canvas.addEventListener(nt,this.handleMouseClick,!1)};handleMouseClick=t=>{const e=document.getElementById("canvas");t.preventDefault();var i=e.getBoundingClientRect();const s=t.clientX-i.left,n=t.clientY-i.top;this.yesButton.onClick(s,n)&&(this.playClickSound(),this.dispose(),this.yesCallback()),this.noButton.onClick(s,n)&&(this.playClickSound(),this.dispose(),this.noCallback())};draw(){if(this.imagesLoaded){this.context.fillStyle="rgba(0,0,0,0.5)",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.pop_up_image,.1*this.canvas.width,.2*this.canvas.height,.8*this.canvas.width,.8*this.canvas.width);this.canvas.height;this.context.fillStyle="white",this.context.font="24px Arial",this.context.fillText("Are you sure?",this.canvas.width/2,this.canvas.height/2.8),this.yesButton.draw(),this.noButton.draw()}}playClickSound=()=>{this.audioPlayer.playButtonClickSound()};dispose=()=>{this.canvas.removeEventListener(nt,this.handleMouseClick,!1)}}class jt{canvas;context;cancelButton;retryButton;closeButton;imagesLoaded=!1;pop_up_image;callback;switchToLevelSelection;reloadScene;gameplayData;audioPlayer;retrySurePopup;CloseSurePopup;isRetryButtonClicked=!1;isCloseButtonClicked=!1;constructor(t,e,i,s,n){this.canvas=t,this.callback=e,this.gameplayData=n,this.switchToLevelSelection=i,this.reloadScene=s;const a=document.getElementById("canvas");this.context=a.getContext("2d"),this.audioPlayer=new Pt,this.cancelButton=new _t(this.context,this.canvas),this.retryButton=new Mt(this.context,this.canvas,.55*this.canvas.width,.2*this.canvas.height+.4*this.canvas.width-.19*this.canvas.width/2),this.closeButton=new At(this.context,this.canvas,.25*this.canvas.width,.2*this.canvas.height+.4*this.canvas.width-.19*this.canvas.width/2),R({pop_up_image:A},(t=>{this.pop_up_image=t.pop_up_image,this.imagesLoaded=!0})),this.retrySurePopup=new Ft(this.canvas,this.yesRetryCallback,this.noRetryCallback),this.CloseSurePopup=new Ft(this.canvas,this.switchToLevelSelection,this.noCloseCallback)}yesRetryCallback=()=>{this.playClickSound(),this.reloadScene(this.gameplayData,"GamePlay")};noRetryCallback=()=>{this.isRetryButtonClicked&&(this.isRetryButtonClicked=!1,this.callback())};noCloseCallback=()=>{this.isCloseButtonClicked&&(this.isCloseButtonClicked=!1,this.callback())};addListner=()=>{document.getElementById("canvas").addEventListener(nt,this.handleMouseClick,!1)};handleMouseClick=t=>{const e=document.getElementById("canvas");t.preventDefault();var i=e.getBoundingClientRect();const s=t.clientX-i.left,n=t.clientY-i.top;this.cancelButton.onClick(s,n)&&(this.playClickSound(),this.callback()),this.retryButton.onClick(s,n)&&("english"==Q?(this.playClickSound(),this.dispose(),this.isRetryButtonClicked=!0,this.retrySurePopup.addListner(),this.playAreYouSureSound()):(this.playClickSound(),this.dispose(),this.reloadScene(this.gameplayData,"GamePlay"))),this.closeButton.onClick(s,n)&&("english"==Q?(this.playClickSound(),this.dispose(),this.isCloseButtonClicked=!0,this.CloseSurePopup.addListner(),this.playAreYouSureSound()):(this.playClickSound(),this.dispose(),this.switchToLevelSelection("GamePlay")))};draw(){this.imagesLoaded&&(this.context.fillStyle="rgba(0,0,0,0.5)",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.pop_up_image,.1*this.canvas.width,.2*this.canvas.height,.8*this.canvas.width,.8*this.canvas.width),this.cancelButton.draw(),this.retryButton.draw(),this.closeButton.draw(),1==this.isRetryButtonClicked&&"english"==Q&&this.retrySurePopup.draw(),1==this.isCloseButtonClicked&&"english"==Q&&this.CloseSurePopup.draw())}playClickSound=()=>{this.audioPlayer.playButtonClickSound()};playAreYouSureSound=()=>{this.audioPlayer.playAudio("./assets/audios/are-you-sure.mp3")};dispose=()=>{document.getElementById("canvas").removeEventListener(nt,this.handleMouseClick,!1)}}const Rt=function(t){const e=[];let i=0;for(let s=0;s<t.length;s++){let n=t.charCodeAt(s);n<128?e[i++]=n:n<2048?(e[i++]=n>>6|192,e[i++]=63&n|128):55296==(64512&n)&&s+1<t.length&&56320==(64512&t.charCodeAt(s+1))?(n=65536+((1023&n)<<10)+(1023&t.charCodeAt(++s)),e[i++]=n>>18|240,e[i++]=n>>12&63|128,e[i++]=n>>6&63|128,e[i++]=63&n|128):(e[i++]=n>>12|224,e[i++]=n>>6&63|128,e[i++]=63&n|128)}return e},Ht={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let e=0;e<t.length;e+=3){const n=t[e],a=e+1<t.length,o=a?t[e+1]:0,r=e+2<t.length,h=r?t[e+2]:0,l=n>>2,c=(3&n)<<4|o>>4;let d=(15&o)<<2|h>>6,u=63&h;r||(u=64,a||(d=64)),s.push(i[l],i[c],i[d],i[u])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Rt(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let i=0,s=0;for(;i<t.length;){const n=t[i++];if(n<128)e[s++]=String.fromCharCode(n);else if(n>191&&n<224){const a=t[i++];e[s++]=String.fromCharCode((31&n)<<6|63&a)}else if(n>239&&n<365){const a=((7&n)<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++])-65536;e[s++]=String.fromCharCode(55296+(a>>10)),e[s++]=String.fromCharCode(56320+(1023&a))}else{const a=t[i++],o=t[i++];e[s++]=String.fromCharCode((15&n)<<12|(63&a)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let e=0;e<t.length;){const n=i[t.charAt(e++)],a=e<t.length?i[t.charAt(e)]:0;++e;const o=e<t.length?i[t.charAt(e)]:64;++e;const r=e<t.length?i[t.charAt(e)]:64;if(++e,null==n||null==a||null==o||null==r)throw new Xt;const h=n<<2|a>>4;if(s.push(h),64!==o){const t=a<<4&240|o>>2;if(s.push(t),64!==r){const t=o<<6&192|r;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Xt extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Wt=function(t){return function(t){const e=Rt(t);return Ht.encodeByteArray(e,!0)}(t).replace(/\./g,"")},Vt=function(t){try{return Ht.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};const Ut=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,Yt=()=>{try{return Ut()||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&Vt(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},Gt=()=>{var t;return null===(t=Yt())||void 0===t?void 0:t.config};class $t{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,i))}}}function qt(){try{return"object"==typeof indexedDB}catch(t){return!1}}function Kt(){return new Promise(((t,e)=>{try{let i=!0;const s="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(s);n.onsuccess=()=>{n.result.close(),i||self.indexedDB.deleteDatabase(s),t(!0)},n.onupgradeneeded=()=>{i=!1},n.onerror=()=>{var t;e((null===(t=n.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class Jt extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name="FirebaseError",Object.setPrototypeOf(this,Jt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Qt.prototype.create)}}class Qt{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){const i=e[0]||{},s=`${this.service}/${t}`,n=this.errors[t],a=n?function(t,e){return t.replace(Zt,((t,i)=>{const s=e[i];return null!=s?String(s):`<${i}?>`}))}(n,i):"Error",o=`${this.serviceName}: ${a} (${s}).`;return new Jt(s,o,i)}}const Zt=/\{\$([^}]+)}/g;function te(t,e){if(t===e)return!0;const i=Object.keys(t),s=Object.keys(e);for(const n of i){if(!s.includes(n))return!1;const i=t[n],a=e[n];if(ee(i)&&ee(a)){if(!te(i,a))return!1}else if(i!==a)return!1}for(const t of s)if(!i.includes(t))return!1;return!0}function ee(t){return null!==t&&"object"==typeof t}const ie=1e3,se=2,ne=144e5,ae=.5;function oe(t,e=ie,i=se){const s=e*Math.pow(i,t),n=Math.round(ae*s*(Math.random()-.5)*2);return Math.min(ne,s+n)}function re(t){return t&&t._delegate?t._delegate:t}class he{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const le="[DEFAULT]";class ce{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new $t;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:e});i&&t.resolve(i)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const i=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),s=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(i)&&!this.shouldAutoInitialize()){if(s)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:i})}catch(t){if(s)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:le})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:i});e.resolve(t)}catch(t){}}}}clearInstance(t=le){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=le){return this.instances.has(t)}getOptions(t=le){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:e});for(const[t,e]of this.instancesDeferred.entries()){i===this.normalizeInstanceIdentifier(t)&&e.resolve(s)}return s}onInit(t,e){var i;const s=this.normalizeInstanceIdentifier(e),n=null!==(i=this.onInitCallbacks.get(s))&&void 0!==i?i:new Set;n.add(t),this.onInitCallbacks.set(s,n);const a=this.instances.get(s);return a&&t(a,s),()=>{n.delete(t)}}invokeOnInitCallbacks(t,e){const i=this.onInitCallbacks.get(e);if(i)for(const s of i)try{s(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(s=t,s===le?void 0:s),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch(t){}var s;return i||null}normalizeInstanceIdentifier(t=le){return this.component?this.component.multipleInstances?t:le:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class de{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new ce(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const ue=[];var ge;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(ge||(ge={}));const me={debug:ge.DEBUG,verbose:ge.VERBOSE,info:ge.INFO,warn:ge.WARN,error:ge.ERROR,silent:ge.SILENT},pe=ge.INFO,fe={[ge.DEBUG]:"log",[ge.VERBOSE]:"log",[ge.INFO]:"info",[ge.WARN]:"warn",[ge.ERROR]:"error"},ve=(t,e,...i)=>{if(e<t.logLevel)return;const s=(new Date).toISOString(),n=fe[e];if(!n)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[n](`[${s}]  ${t.name}:`,...i)};class we{constructor(t){this.name=t,this._logLevel=pe,this._logHandler=ve,this._userLogHandler=null,ue.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in ge))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?me[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,ge.DEBUG,...t),this._logHandler(this,ge.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,ge.VERBOSE,...t),this._logHandler(this,ge.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,ge.INFO,...t),this._logHandler(this,ge.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,ge.WARN,...t),this._logHandler(this,ge.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,ge.ERROR,...t),this._logHandler(this,ge.ERROR,...t)}}const be=(t,e)=>e.some((e=>t instanceof e));let Se,ye;const Ie=new WeakMap,xe=new WeakMap,Te=new WeakMap,Ce=new WeakMap,Le=new WeakMap;let Pe={get(t,e,i){if(t instanceof IDBTransaction){if("done"===e)return xe.get(t);if("objectStoreNames"===e)return t.objectStoreNames||Te.get(t);if("store"===e)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return ke(t[e])},set:(t,e,i)=>(t[e]=i,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function Ee(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ye||(ye=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Ae(this),e),ke(Ie.get(this))}:function(...e){return ke(t.apply(Ae(this),e))}:function(e,...i){const s=t.call(Ae(this),e,...i);return Te.set(s,e.sort?e.sort():[e]),ke(s)}}function ze(t){return"function"==typeof t?Ee(t):(t instanceof IDBTransaction&&function(t){if(xe.has(t))return;const e=new Promise(((e,i)=>{const s=()=>{t.removeEventListener("complete",n),t.removeEventListener("error",a),t.removeEventListener("abort",a)},n=()=>{e(),s()},a=()=>{i(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",n),t.addEventListener("error",a),t.addEventListener("abort",a)}));xe.set(t,e)}(t),be(t,Se||(Se=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,Pe):t)}function ke(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,i)=>{const s=()=>{t.removeEventListener("success",n),t.removeEventListener("error",a)},n=()=>{e(ke(t.result)),s()},a=()=>{i(t.error),s()};t.addEventListener("success",n),t.addEventListener("error",a)}));return e.then((e=>{e instanceof IDBCursor&&Ie.set(e,t)})).catch((()=>{})),Le.set(e,t),e}(t);if(Ce.has(t))return Ce.get(t);const e=ze(t);return e!==t&&(Ce.set(t,e),Le.set(e,t)),e}const Ae=t=>Le.get(t);const _e=["get","getKey","getAll","getAllKeys","count"],De=["put","add","delete","clear"],Be=new Map;function Me(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Be.get(e))return Be.get(e);const i=e.replace(/FromIndex$/,""),s=e!==i,n=De.includes(i);if(!(i in(s?IDBIndex:IDBObjectStore).prototype)||!n&&!_e.includes(i))return;const a=async function(t,...e){const a=this.transaction(t,n?"readwrite":"readonly");let o=a.store;return s&&(o=o.index(e.shift())),(await Promise.all([o[i](...e),n&&a.done]))[0]};return Be.set(e,a),a}Pe=(t=>({...t,get:(e,i,s)=>Me(e,i)||t.get(e,i,s),has:(e,i)=>!!Me(e,i)||t.has(e,i)}))(Pe);class Oe{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const Ne="@firebase/app",Fe="0.9.15",je=new we("@firebase/app"),Re="@firebase/app-compat",He="@firebase/analytics-compat",Xe="@firebase/analytics",We="@firebase/app-check-compat",Ve="@firebase/app-check",Ue="@firebase/auth",Ye="@firebase/auth-compat",Ge="@firebase/database",$e="@firebase/database-compat",qe="@firebase/functions",Ke="@firebase/functions-compat",Je="@firebase/installations",Qe="@firebase/installations-compat",Ze="@firebase/messaging",ti="@firebase/messaging-compat",ei="@firebase/performance",ii="@firebase/performance-compat",si="@firebase/remote-config",ni="@firebase/remote-config-compat",ai="@firebase/storage",oi="@firebase/storage-compat",ri="@firebase/firestore",hi="@firebase/firestore-compat",li="firebase",ci="[DEFAULT]",di={[Ne]:"fire-core",[Re]:"fire-core-compat",[Xe]:"fire-analytics",[He]:"fire-analytics-compat",[Ve]:"fire-app-check",[We]:"fire-app-check-compat",[Ue]:"fire-auth",[Ye]:"fire-auth-compat",[Ge]:"fire-rtdb",[$e]:"fire-rtdb-compat",[qe]:"fire-fn",[Ke]:"fire-fn-compat",[Je]:"fire-iid",[Qe]:"fire-iid-compat",[Ze]:"fire-fcm",[ti]:"fire-fcm-compat",[ei]:"fire-perf",[ii]:"fire-perf-compat",[si]:"fire-rc",[ni]:"fire-rc-compat",[ai]:"fire-gcs",[oi]:"fire-gcs-compat",[ri]:"fire-fst",[hi]:"fire-fst-compat","fire-js":"fire-js",[li]:"fire-js-all"},ui=new Map,gi=new Map;function mi(t,e){try{t.container.addComponent(e)}catch(i){je.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,i)}}function pi(t){const e=t.name;if(gi.has(e))return je.debug(`There were multiple attempts to register component ${e}.`),!1;gi.set(e,t);for(const e of ui.values())mi(e,t);return!0}function fi(t,e){const i=t.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),t.container.getProvider(e)}const vi=new Qt("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class wi{constructor(t,e,i){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new he("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw vi.create("app-deleted",{appName:this._name})}}function bi(t,e={}){let i=t;if("object"!=typeof e){e={name:e}}const s=Object.assign({name:ci,automaticDataCollectionEnabled:!1},e),n=s.name;if("string"!=typeof n||!n)throw vi.create("bad-app-name",{appName:String(n)});if(i||(i=Gt()),!i)throw vi.create("no-options");const a=ui.get(n);if(a){if(te(i,a.options)&&te(s,a.config))return a;throw vi.create("duplicate-app",{appName:n})}const o=new de(n);for(const t of gi.values())o.addComponent(t);const r=new wi(i,s,o);return ui.set(n,r),r}function Si(t,e,i){var s;let n=null!==(s=di[t])&&void 0!==s?s:t;i&&(n+=`-${i}`);const a=n.match(/\s|\//),o=e.match(/\s|\//);if(a||o){const t=[`Unable to register library "${n}" with version "${e}":`];return a&&t.push(`library name "${n}" contains illegal characters (whitespace or "/")`),a&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void je.warn(t.join(" "))}pi(new he(`${n}-version`,(()=>({library:n,version:e})),"VERSION"))}const yi="firebase-heartbeat-database",Ii=1,xi="firebase-heartbeat-store";let Ti=null;function Ci(){return Ti||(Ti=function(t,e,{blocked:i,upgrade:s,blocking:n,terminated:a}={}){const o=indexedDB.open(t,e),r=ke(o);return s&&o.addEventListener("upgradeneeded",(t=>{s(ke(o.result),t.oldVersion,t.newVersion,ke(o.transaction),t)})),i&&o.addEventListener("blocked",(t=>i(t.oldVersion,t.newVersion,t))),r.then((t=>{a&&t.addEventListener("close",(()=>a())),n&&t.addEventListener("versionchange",(t=>n(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),r}(yi,Ii,{upgrade:(t,e)=>{if(0===e)t.createObjectStore(xi)}}).catch((t=>{throw vi.create("idb-open",{originalErrorMessage:t.message})}))),Ti}async function Li(t,e){try{const i=(await Ci()).transaction(xi,"readwrite"),s=i.objectStore(xi);await s.put(e,Pi(t)),await i.done}catch(t){if(t instanceof Jt)je.warn(t.message);else{const e=vi.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});je.warn(e.message)}}}function Pi(t){return`${t.name}!${t.options.appId}`}class Ei{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new ki(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=zi();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=zi(),{heartbeatsToSend:e,unsentEntries:i}=function(t,e=1024){const i=[];let s=t.slice();for(const n of t){const t=i.find((t=>t.agent===n.agent));if(t){if(t.dates.push(n.date),Ai(i)>e){t.dates.pop();break}}else if(i.push({agent:n.agent,dates:[n.date]}),Ai(i)>e){i.pop();break}s=s.slice(1)}return{heartbeatsToSend:i,unsentEntries:s}}(this._heartbeatsCache.heartbeats),s=Wt(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function zi(){return(new Date).toISOString().substring(0,10)}class ki{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!qt()&&Kt().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await Ci();return await e.transaction(xi).objectStore(xi).get(Pi(t))}catch(t){if(t instanceof Jt)je.warn(t.message);else{const e=vi.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});je.warn(e.message)}}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const i=await this.read();return Li(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const i=await this.read();return Li(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}}}function Ai(t){return Wt(JSON.stringify({version:2,heartbeats:t})).length}var _i;_i="",pi(new he("platform-logger",(t=>new Oe(t)),"PRIVATE")),pi(new he("heartbeat",(t=>new Ei(t)),"PRIVATE")),Si(Ne,Fe,_i),Si(Ne,Fe,"esm2017"),Si("fire-js","");Si("firebase","10.1.0","app");const Di=(t,e)=>e.some((e=>t instanceof e));let Bi,Mi;const Oi=new WeakMap,Ni=new WeakMap,Fi=new WeakMap,ji=new WeakMap,Ri=new WeakMap;let Hi={get(t,e,i){if(t instanceof IDBTransaction){if("done"===e)return Ni.get(t);if("objectStoreNames"===e)return t.objectStoreNames||Fi.get(t);if("store"===e)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Vi(t[e])},set:(t,e,i)=>(t[e]=i,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function Xi(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Mi||(Mi=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Ui(this),e),Vi(Oi.get(this))}:function(...e){return Vi(t.apply(Ui(this),e))}:function(e,...i){const s=t.call(Ui(this),e,...i);return Fi.set(s,e.sort?e.sort():[e]),Vi(s)}}function Wi(t){return"function"==typeof t?Xi(t):(t instanceof IDBTransaction&&function(t){if(Ni.has(t))return;const e=new Promise(((e,i)=>{const s=()=>{t.removeEventListener("complete",n),t.removeEventListener("error",a),t.removeEventListener("abort",a)},n=()=>{e(),s()},a=()=>{i(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",n),t.addEventListener("error",a),t.addEventListener("abort",a)}));Ni.set(t,e)}(t),Di(t,Bi||(Bi=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,Hi):t)}function Vi(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,i)=>{const s=()=>{t.removeEventListener("success",n),t.removeEventListener("error",a)},n=()=>{e(Vi(t.result)),s()},a=()=>{i(t.error),s()};t.addEventListener("success",n),t.addEventListener("error",a)}));return e.then((e=>{e instanceof IDBCursor&&Oi.set(e,t)})).catch((()=>{})),Ri.set(e,t),e}(t);if(ji.has(t))return ji.get(t);const e=Wi(t);return e!==t&&(ji.set(t,e),Ri.set(e,t)),e}const Ui=t=>Ri.get(t);const Yi=["get","getKey","getAll","getAllKeys","count"],Gi=["put","add","delete","clear"],$i=new Map;function qi(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if($i.get(e))return $i.get(e);const i=e.replace(/FromIndex$/,""),s=e!==i,n=Gi.includes(i);if(!(i in(s?IDBIndex:IDBObjectStore).prototype)||!n&&!Yi.includes(i))return;const a=async function(t,...e){const a=this.transaction(t,n?"readwrite":"readonly");let o=a.store;return s&&(o=o.index(e.shift())),(await Promise.all([o[i](...e),n&&a.done]))[0]};return $i.set(e,a),a}!function(t){Hi=t(Hi)}((t=>({...t,get:(e,i,s)=>qi(e,i)||t.get(e,i,s),has:(e,i)=>!!qi(e,i)||t.has(e,i)})));const Ki="@firebase/installations",Ji="0.6.4",Qi=1e4,Zi=`w:${Ji}`,ts="FIS_v2",es="https://firebaseinstallations.googleapis.com/v1",is=36e5,ss=new Qt("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function ns(t){return t instanceof Jt&&t.code.includes("request-failed")}function as({projectId:t}){return`${es}/projects/${t}/installations`}function os(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function rs(t,e){const i=(await e.json()).error;return ss.create("request-failed",{requestName:t,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})}function hs({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function ls(t,{refreshToken:e}){const i=hs(t);return i.append("Authorization",function(t){return`${ts} ${t}`}(e)),i}async function cs(t){const e=await t();return e.status>=500&&e.status<600?t():e}function ds(t){return new Promise((e=>{setTimeout(e,t)}))}const us=/^[cdef][\w-]{21}$/,gs="";function ms(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){const e=(i=t,btoa(String.fromCharCode(...i)).replace(/\+/g,"-").replace(/\//g,"_"));var i;return e.substr(0,22)}(t);return us.test(e)?e:gs}catch(t){return gs}}function ps(t){return`${t.appName}!${t.appId}`}const fs=new Map;function vs(t,e){const i=ps(t);ws(i,e),function(t,e){const i=Ss();i&&i.postMessage({key:t,fid:e});ys()}(i,e)}function ws(t,e){const i=fs.get(t);if(i)for(const t of i)t(e)}let bs=null;function Ss(){return!bs&&"BroadcastChannel"in self&&(bs=new BroadcastChannel("[Firebase] FID Change"),bs.onmessage=t=>{ws(t.data.key,t.data.fid)}),bs}function ys(){0===fs.size&&bs&&(bs.close(),bs=null)}const Is="firebase-installations-database",xs=1,Ts="firebase-installations-store";let Cs=null;function Ls(){return Cs||(Cs=function(t,e,{blocked:i,upgrade:s,blocking:n,terminated:a}={}){const o=indexedDB.open(t,e),r=Vi(o);return s&&o.addEventListener("upgradeneeded",(t=>{s(Vi(o.result),t.oldVersion,t.newVersion,Vi(o.transaction))})),i&&o.addEventListener("blocked",(()=>i())),r.then((t=>{a&&t.addEventListener("close",(()=>a())),n&&t.addEventListener("versionchange",(()=>n()))})).catch((()=>{})),r}(Is,xs,{upgrade:(t,e)=>{if(0===e)t.createObjectStore(Ts)}})),Cs}async function Ps(t,e){const i=ps(t),s=(await Ls()).transaction(Ts,"readwrite"),n=s.objectStore(Ts),a=await n.get(i);return await n.put(e,i),await s.done,a&&a.fid===e.fid||vs(t,e.fid),e}async function Es(t){const e=ps(t),i=(await Ls()).transaction(Ts,"readwrite");await i.objectStore(Ts).delete(e),await i.done}async function zs(t,e){const i=ps(t),s=(await Ls()).transaction(Ts,"readwrite"),n=s.objectStore(Ts),a=await n.get(i),o=e(a);return void 0===o?await n.delete(i):await n.put(o,i),await s.done,!o||a&&a.fid===o.fid||vs(t,o.fid),o}async function ks(t){let e;const i=await zs(t.appConfig,(i=>{const s=function(t){const e=t||{fid:ms(),registrationStatus:0};return Ds(e)}(i),n=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine){return{installationEntry:e,registrationPromise:Promise.reject(ss.create("app-offline"))}}const i={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=async function(t,e){try{const i=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:i}){const s=as(t),n=hs(t),a=e.getImmediate({optional:!0});if(a){const t=await a.getHeartbeatsHeader();t&&n.append("x-firebase-client",t)}const o={fid:i,authVersion:ts,appId:t.appId,sdkVersion:Zi},r={method:"POST",headers:n,body:JSON.stringify(o)},h=await cs((()=>fetch(s,r)));if(h.ok){const t=await h.json();return{fid:t.fid||i,registrationStatus:2,refreshToken:t.refreshToken,authToken:os(t.authToken)}}throw await rs("Create Installation",h)}(t,e);return Ps(t.appConfig,i)}catch(i){throw ns(i)&&409===i.customData.serverCode?await Es(t.appConfig):await Ps(t.appConfig,{fid:e.fid,registrationStatus:0}),i}}(t,i);return{installationEntry:i,registrationPromise:s}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:As(t)}:{installationEntry:e}}(t,s);return e=n.registrationPromise,n.installationEntry}));return i.fid===gs?{installationEntry:await e}:{installationEntry:i,registrationPromise:e}}async function As(t){let e=await _s(t.appConfig);for(;1===e.registrationStatus;)await ds(100),e=await _s(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:i}=await ks(t);return i||e}return e}function _s(t){return zs(t,(t=>{if(!t)throw ss.create("installation-not-found");return Ds(t)}))}function Ds(t){return 1===(e=t).registrationStatus&&e.registrationTime+Qi<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function Bs({appConfig:t,heartbeatServiceProvider:e},i){const s=function(t,{fid:e}){return`${as(t)}/${e}/authTokens:generate`}(t,i),n=ls(t,i),a=e.getImmediate({optional:!0});if(a){const t=await a.getHeartbeatsHeader();t&&n.append("x-firebase-client",t)}const o={installation:{sdkVersion:Zi,appId:t.appId}},r={method:"POST",headers:n,body:JSON.stringify(o)},h=await cs((()=>fetch(s,r)));if(h.ok){return os(await h.json())}throw await rs("Generate Auth Token",h)}async function Ms(t,e=!1){let i;const s=await zs(t.appConfig,(s=>{if(!Ns(s))throw ss.create("not-registered");const n=s.authToken;if(!e&&function(t){return 2===t.requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+is}(t)}(n))return s;if(1===n.requestStatus)return i=async function(t,e){let i=await Os(t.appConfig);for(;1===i.authToken.requestStatus;)await ds(100),i=await Os(t.appConfig);const s=i.authToken;return 0===s.requestStatus?Ms(t,e):s}(t,e),s;{if(!navigator.onLine)throw ss.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(s);return i=async function(t,e){try{const i=await Bs(t,e),s=Object.assign(Object.assign({},e),{authToken:i});return await Ps(t.appConfig,s),i}catch(i){if(!ns(i)||401!==i.customData.serverCode&&404!==i.customData.serverCode){const i=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Ps(t.appConfig,i)}else await Es(t.appConfig);throw i}}(t,e),e}}));return i?await i:s.authToken}function Os(t){return zs(t,(t=>{if(!Ns(t))throw ss.create("not-registered");const e=t.authToken;return 1===(i=e).requestStatus&&i.requestTime+Qi<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var i}))}function Ns(t){return void 0!==t&&2===t.registrationStatus}async function Fs(t,e=!1){const i=t;await async function(t){const{registrationPromise:e}=await ks(t);e&&await e}(i);return(await Ms(i,e)).token}function js(t){return ss.create("missing-app-config-values",{valueName:t})}const Rs="installations",Hs=t=>{const e=t.getProvider("app").getImmediate(),i=function(t){if(!t||!t.options)throw js("App Configuration");if(!t.name)throw js("App Name");const e=["projectId","apiKey","appId"];for(const i of e)if(!t.options[i])throw js(i);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:i,heartbeatServiceProvider:fi(e,"heartbeat"),_delete:()=>Promise.resolve()}},Xs=t=>{const e=fi(t.getProvider("app").getImmediate(),Rs).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:i,registrationPromise:s}=await ks(e);return s?s.catch(console.error):Ms(e).catch(console.error),i.fid}(e),getToken:t=>Fs(e,t)}};pi(new he(Rs,Hs,"PUBLIC")),pi(new he("installations-internal",Xs,"PRIVATE")),Si(Ki,Ji),Si(Ki,Ji,"esm2017");const Ws="analytics",Vs="firebase_id",Us="origin",Ys=6e4,Gs="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",$s="https://www.googletagmanager.com/gtag/js",qs=new we("@firebase/analytics"),Ks=new Qt("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function Js(t){if(!t.startsWith($s)){const e=Ks.create("invalid-gtag-resource",{gtagURL:t});return qs.warn(e.message),""}return t}function Qs(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}function Zs(t,e){const i=function(t,e){let i;return window.trustedTypes&&(i=window.trustedTypes.createPolicy(t,e)),i}("firebase-js-sdk-policy",{createScriptURL:Js}),s=document.createElement("script"),n=`${$s}?l=${t}&id=${e}`;s.src=i?null==i?void 0:i.createScriptURL(n):n,s.async=!0,document.head.appendChild(s)}function tn(t,e,i,s){return async function(n,...a){try{if("event"===n){const[s,n]=a;await async function(t,e,i,s,n){try{let a=[];if(n&&n.send_to){let t=n.send_to;Array.isArray(t)||(t=[t]);const s=await Qs(i);for(const i of t){const t=s.find((t=>t.measurementId===i)),n=t&&e[t.appId];if(!n){a=[];break}a.push(n)}}0===a.length&&(a=Object.values(e)),await Promise.all(a),t("event",s,n||{})}catch(t){qs.error(t)}}(t,e,i,s,n)}else if("config"===n){const[n,o]=a;await async function(t,e,i,s,n,a){const o=s[n];try{if(o)await e[o];else{const t=(await Qs(i)).find((t=>t.measurementId===n));t&&await e[t.appId]}}catch(t){qs.error(t)}t("config",n,a)}(t,e,i,s,n,o)}else if("consent"===n){const[e]=a;t("consent","update",e)}else if("get"===n){const[e,i,s]=a;t("get",e,i,s)}else if("set"===n){const[e]=a;t("set",e)}else t(n,...a)}catch(t){qs.error(t)}}}const en=30;const sn=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function nn(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function an(t,e=sn,i){const{appId:s,apiKey:n,measurementId:a}=t.options;if(!s)throw Ks.create("no-app-id");if(!n){if(a)return{measurementId:a,appId:s};throw Ks.create("no-api-key")}const o=e.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},r=new rn;return setTimeout((async()=>{r.abort()}),void 0!==i?i:Ys),on({appId:s,apiKey:n,measurementId:a},o,r,e)}async function on(t,{throttleEndTimeMillis:e,backoffCount:i},s,n=sn){var a;const{appId:o,measurementId:r}=t;try{await function(t,e){return new Promise(((i,s)=>{const n=Math.max(e-Date.now(),0),a=setTimeout(i,n);t.addEventListener((()=>{clearTimeout(a),s(Ks.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(s,e)}catch(t){if(r)return qs.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${r} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:o,measurementId:r};throw t}try{const e=await async function(t){var e;const{appId:i,apiKey:s}=t,n={method:"GET",headers:nn(s)},a=Gs.replace("{app-id}",i),o=await fetch(a,n);if(200!==o.status&&304!==o.status){let t="";try{const i=await o.json();(null===(e=i.error)||void 0===e?void 0:e.message)&&(t=i.error.message)}catch(t){}throw Ks.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return n.deleteThrottleMetadata(o),e}catch(e){const h=e;if(!function(t){if(!(t instanceof Jt&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(h)){if(n.deleteThrottleMetadata(o),r)return qs.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${r} provided in the "measurementId" field in the local Firebase config. [${null==h?void 0:h.message}]`),{appId:o,measurementId:r};throw e}const l=503===Number(null===(a=null==h?void 0:h.customData)||void 0===a?void 0:a.httpStatus)?oe(i,n.intervalMillis,en):oe(i,n.intervalMillis),c={throttleEndTimeMillis:Date.now()+l,backoffCount:i+1};return n.setThrottleMetadata(o,c),qs.debug(`Calling attemptFetch again in ${l} millis`),on(t,c,s,n)}}class rn{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let hn,ln;function cn(t){ln=t}function dn(t){hn=t}async function un(t,e,i,s,n,a,o){var r;const h=an(t);h.then((e=>{i[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&qs.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>qs.error(t))),e.push(h);const l=async function(){if(!qt())return qs.warn(Ks.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await Kt()}catch(t){return qs.warn(Ks.create("indexeddb-unavailable",{errorInfo:null==t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?s.getId():void 0)),[c,d]=await Promise.all([h,l]);(function(t){const e=window.document.getElementsByTagName("script");for(const i of Object.values(e))if(i.src&&i.src.includes($s)&&i.src.includes(t))return i;return null})(a)||Zs(a,c.measurementId),ln&&(n("consent","default",ln),cn(void 0)),n("js",new Date);const u=null!==(r=null==o?void 0:o.config)&&void 0!==r?r:{};return u[Us]="firebase",u.update=!0,null!=d&&(u[Vs]=d),n("config",c.measurementId,u),hn&&(n("set",hn),dn(void 0)),c.measurementId}class gn{constructor(t){this.app=t}_delete(){return delete mn[this.app.options.appId],Promise.resolve()}}let mn={},pn=[];const fn={};let vn,wn,bn="dataLayer",Sn="gtag",yn=!1;function In(){const t=[];if(function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),i=Ks.create("invalid-analytics-context",{errorInfo:e});qs.warn(i.message)}}function xn(t,e,i){In();const s=t.options.appId;if(!s)throw Ks.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw Ks.create("no-api-key");qs.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=mn[s])throw Ks.create("already-exists",{id:s});if(!yn){!function(t){let e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(bn);const{wrappedGtag:t,gtagCore:e}=function(t,e,i,s,n){let a=function(...t){window[s].push(arguments)};return window[n]&&"function"==typeof window[n]&&(a=window[n]),window[n]=tn(a,t,e,i),{gtagCore:a,wrappedGtag:window[n]}}(mn,pn,fn,bn,Sn);wn=t,vn=e,yn=!0}mn[s]=un(t,pn,fn,e,vn,bn,i);return new gn(t)}function Tn(t=function(t=ci){const e=ui.get(t);if(!e&&t===ci&&Gt())return bi();if(!e)throw vi.create("no-app",{appName:t});return e}()){const e=fi(t=re(t),Ws);return e.isInitialized()?e.getImmediate():function(t,e={}){const i=fi(t,Ws);if(i.isInitialized()){const t=i.getImmediate();if(te(e,i.getOptions()))return t;throw Ks.create("already-initialized")}const s=i.initialize({options:e});return s}(t)}function Cn(t,e,i){t=re(t),async function(t,e,i,s){if(s&&s.global){const e={};for(const t of Object.keys(i))e[`user_properties.${t}`]=i[t];return t("set",e),Promise.resolve()}t("config",await e,{update:!0,user_properties:i})}(wn,mn[t.app.options.appId],e,i).catch((t=>qs.error(t)))}function Ln(t,e,i,s){t=re(t),async function(t,e,i,s,n){if(n&&n.global)t("event",i,s);else{const n=await e;t("event",i,Object.assign(Object.assign({},s),{send_to:n}))}}(wn,mn[t.app.options.appId],e,i,s).catch((t=>qs.error(t)))}const Pn="@firebase/analytics",En="0.10.0";pi(new he(Ws,((t,{options:e})=>xn(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),pi(new he("analytics-internal",(function(t){try{const e=t.getProvider(Ws).getImmediate();return{logEvent:(t,i,s)=>Ln(e,t,i,s)}}catch(t){throw Ks.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),Si(Pn,En),Si(Pn,En,"esm2017");const zn={apiKey:"AIzaSyB8c2lBVi26u7YRL9sxOP97Uaq3yN8hTl4",authDomain:"ftm-b9d99.firebaseapp.com",databaseURL:"https://ftm-b9d99.firebaseio.com",projectId:"ftm-b9d99",storageBucket:"ftm-b9d99.appspot.com",messagingSenderId:"602402387941",appId:"1:602402387941:web:a63f4eaddc949f539de10c",measurementId:"G-FVLSN7D7NM"};class kn{firebaseApp;analytics;constructor(){this.initializeFirebase(),null==q&&null==K||this.setUserProperty(q,K)}customEvents(t,e){try{Ln(this.analytics,t,e)}catch(t){console.error("Error while logging custom event:",t)}}sessionEnd(){try{navigator.onLine&&void 0!==this.analytics&&Ln(this.analytics,"session_end")}catch(t){console.error("Error while logging session_end event:",t)}}setUserProperty(t,e){try{Cn(this.analytics,{source:t,campaign_id:e},{global:!0})}catch(t){console.error("Error while setting user properties:",t)}}initializeFirebase(){try{this.firebaseApp=bi(zn),this.analytics=Tn(this.firebaseApp)}catch(t){console.error("Error while initializing Firebase:",t)}}}class An extends kn{static instance;constructor(){super()}static getInstance(){return An.instance||(An.instance=new An),An.instance}sendSessionStartEvent(t){this.customEvents("session_start",t)}sendSessionEndEvent(t){this.customEvents("session_end",t)}sendSelectedLevelEvent(t){this.customEvents("selected_level",t)}sendTappedStartEvent(t){this.customEvents("tapped_start",t)}sendPuzzleCompletedEvent(t){this.customEvents("puzzle_completed",t)}sendLevelCompletedEvent(t){this.customEvents("level_completed",t)}sendDownloadCompletedEvent(t){this.customEvents("download_completed",t)}sendDownload25PercentCompletedEvent(t){this.customEvents("download_25",t)}sendDownload50PercentCompletedEvent(t){this.customEvents("download_50",t)}sendDownload75PercentCompletedEvent(t){this.customEvents("download_75",t)}}const _n={summer:{BG_GROUP_IMGS:D,draw:function(t,e,i,s){return{draw:()=>{t.drawImage(s?.DEFAULT_BACKGROUND_1,0,0,e,i),t.drawImage(s?.ASSETS_PATH_TOTEM,.6*e,i/6,e,i/2),t.drawImage(s?.ASSETS_PATH_FENCE,.4*-e,i/3,e,i/3),t.drawImage(s?.ASSETS_PATH_HILL,.25*-e,i/2,1.5*e,i/2)}}}},autumn:{BG_GROUP_IMGS:B,draw:function(t,e,i,s){return{draw:()=>{t.drawImage(s.AUTUMN_BACKGROUND_1,0,0,e,i),t.drawImage(s.AUTUMN_PILLAR_1,.38*e,i/6,e/1.2,i/2),t.drawImage(s.AUTUMN_FENCE_1,.4*-e,i/4,e,i/2),t.drawImage(s.AUTUMN_HILL_1,.25*-e,i/2,1.5*e,i/2)}}}},winter:{BG_GROUP_IMGS:M,draw:function(t,e,i,s){return{draw:()=>{t.drawImage(s.WINTER_BACKGROUND_1,0,0,e,i),t.drawImage(s.WINTER_PILLAR_1,.38*e,i/6,e/1.2,i/2),t.drawImage(s.WINTER_FENCE_1,.4*-e,i/4,e,i/2),t.drawImage(s.WINTER_HILL_1,.25*-e,i/2,1.5*e,i/2)}}}}};async function Dn(t,e,i,s,n){return{...{...n(t,e,i,{...await H(s)})}}}const Bn=(t,e)=>{const i=Object.keys(e);let s=Math.floor(t/10)%i.length;return t>=30&&(s%=3),{...e[i[s]]}};function Mn(t,e,i,s){return{draw:()=>{t.drawImage(s?.LEVEL_SELECTION_BACKGROUND,0,0,e,i)}}}async function On(t,e,i,s){const n=(t=>N.includes(t))(i);return{...{x:t,y:e,index:i,isSpecial:n,...s,balloonImg:n?s?.specialBloonImg:s?.balloonImg}}}class Nn{levelData;puzzleNumber;groupedLetters;droppedLetters;groupedObj;droppedHistory;hideListObj;constructor(t,e){this.levelData=t,this.puzzleNumber=e,this.groupedLetters="",this.droppedLetters="",this.groupedObj={},this.droppedHistory={},this.hideListObj={}}getTargetWord(){return this.levelData.puzzles[this.puzzleNumber]?.prompt?.promptText}getValues(){return{groupedLetters:this.groupedLetters,droppedLetters:this.droppedLetters,groupedObj:{...this.groupedObj},droppedHistory:{...this.droppedHistory},hideListObj:{...this.hideListObj}}}checkIsWordPuzzle(){return"Word"===this.levelData?.levelMeta?.levelType}updatePuzzleLevel(t){this.clearAllValues(),this.puzzleNumber=t}clearPickedUp(){this.groupedLetters="",this.groupedObj={},this.hideListObj={...this.droppedHistory}}clearAllValues(){this.groupedLetters="",this.droppedLetters="",this.groupedObj={},this.droppedHistory={},this.hideListObj={},this.puzzleNumber=0}validateShouldHideLetter(t){return!this.hideListObj[t]}handleCheckHoveredStone(t,e){const i=this.groupedLetters,s=this.getTargetWord();if(!this.droppedLetters.length&&s[0]!==i[0])return!1;const n=!i.includes(t),a=!this.groupedObj[e];return s.includes(`${this.droppedLetters}${i}${t}`)&&(n||a)}validateFedLetters(){const t=this.getTargetWord();return this.droppedLetters===t.substring(0,this.droppedLetters.length)}validateWordPuzzle(){const t=this.getTargetWord();return this.droppedLetters===t}setGroupToDropped(){this.droppedLetters=`${this.droppedLetters}${this.groupedLetters}`,this.droppedHistory={...this.droppedHistory,...this.groupedObj}}setPickUpLetter(t,e){this.hideListObj={...this.hideListObj,...this.groupedObj},this.groupedLetters=`${this.groupedLetters}${t}`,this.groupedObj[e]=t}}class Fn{width;height;monster;jsonVersionNumber;canvas;levelData;timerTicking;promptText;pauseButton;tutorial;puzzleData;id;context;levelIndicators;stonesCount=1;monsterPhaseNumber;pickedStone;puzzleStartTime;showTutorial;feedBackTexts;isPuzzleCompleted;rightToLeft;imagesLoaded=!1;switchSceneToEnd;levelNumber;loadedImages;stoneHandler;counter=0;images;handler;pickedStoneObject;pausePopup;isPauseButtonClicked=!1;background;feedBackTextCanavsElement;feedbackTextEffects;isGameStarted=!1;time=0;score=0;wrongMoves=0;rightMoves=0;switchToLevelSelection;reloadScene;audioPlayer;firebaseIntegration;startTime;puzzleTime;isDisposing;resetAnimationID;trailParticles;clickTrailToggle;hasFed;wordPuzzleLogic;constructor(t,e,i,n,a,o,r,h,l,c,d){try{this.width=t.width,this.height=t.height,this.rightToLeft=a,this.canvas=t,this.context=this.canvas.getContext("2d",{willReadFrequently:!0}),this.trailParticles=new zt(t),this.monsterPhaseNumber=i||1,this.levelData=e,this.switchSceneToEnd=o,this.levelNumber=r,this.switchToLevelSelection=h,this.reloadScene=l,this.jsonVersionNumber=c,this.startGameTime(),this.startPuzzleTime(),this.isDisposing=!1,this.pauseButton=new wt(this.context,this.canvas),this.timerTicking=new Ct(this.width,this.height,this.loadPuzzle),this.stoneHandler=new It(this.context,this.canvas,this.counter,this.levelData,d,this.timerTicking),this.tutorial=new xt(this.context,t.width,t.height),this.promptText=new yt(this.width,this.height,this.levelData.puzzles[this.counter],this.levelData,this.rightToLeft),this.levelIndicators=new St(this.context,this.canvas,0),this.levelIndicators.setIndicators(this.counter),this.monster=new Tt(this.canvas,this.monsterPhaseNumber),this.switchToLevelSelection=h,this.setSwitchToLevelSelectionWithExitEvent(),this.pausePopup=new jt(this.canvas,this.resumeGame,this.switchToLevelSelection,this.reloadScene,{currentLevelData:e,selectedLevelNumber:r}),this.firebaseIntegration=new An,this.feedbackTextEffects=new Lt,this.audioPlayer=new Pt,this.handler=document.getElementById("canvas"),this.puzzleData=e.puzzles,this.feedBackTexts=n,this.images={profileMonster:v},R(this.images,(t=>{this.loadedImages=Object.assign({},t),this.imagesLoaded=!0}));var u=this.levelData.levelMeta.levelNumber;et.DebugMode?localStorage.setItem(s+Q+"Debug",u):localStorage.setItem(s+Q,u),this.addEventListeners(),this.resetAnimationID=0,this.setupBg(),this.trailParticles?.init(),this.clickTrailToggle=!1,this.hasFed=!1,this.wordPuzzleLogic=new Nn(e,this.counter),console.log("Game loaded successfully")}catch(t){console.error("Error while loading game:",t)}}setupBg=async()=>{const{BG_GROUP_IMGS:t,draw:e}=Bn(this.levelData.levelNumber,_n);this.background=await Dn(this.context,this.width,this.height,t,e)};resumeGame=()=>{this.addEventListeners(),this.isPauseButtonClicked=!1,this.stoneHandler.setGamePause(!1),this.pausePopup.dispose()};getRandomFeedBackText(t){const e=Object.keys(this.feedBackTexts)[t];return this.feedBackTexts[e]}getRandomInt(t,e){const i=Object.values(this.feedBackTexts).filter((t=>null!=t)).length-1;return Math.floor(Math.random()*(i-t+1))+t}handleMouseUp=t=>{let e=this.canvas.getBoundingClientRect();const i=t.clientX-e.left,s=t.clientY-e.top;if(Math.sqrt((i-this.monster.x-this.canvas.width/4)**2+(s-this.monster.y-this.canvas.height/2.2)**2)<=100&&this.pickedStone){const{text:t}=this.pickedStone;switch(this.levelData.levelMeta.levelType){case"LetterOnly":case"LetterInWord":this.letterPuzzle(t);break;case"Word":case"SoundWord":this.wordPuzzle(this.pickedStone)}}else if(this.pickedStone&&this.pickedStoneObject&&this.pickedStone.text&&"number"==typeof this.pickedStoneObject.origx&&"number"==typeof this.pickedStoneObject.origy){const t=50,e=this.width/2;this.pickedStone.x=this.pickedStone.text.length<=3&&this.pickedStoneObject.origx<t&&this.pickedStoneObject.origx<e?this.pickedStoneObject.origx+25:this.pickedStoneObject.origx,this.pickedStone.y=this.pickedStoneObject.origy}this.pickedStone=null,this.wordPuzzleLogic.clearPickedUp(),this.clickTrailToggle=!1};handleMouseDown=t=>{if(this.pickedStone&&this.pickedStone.frame<=99)return;let e=this.canvas.getBoundingClientRect();const i=t.clientX-e.left,s=t.clientY-e.top;if(this.wordPuzzleLogic.checkIsWordPuzzle())this.setPickedUp(i,s);else for(let t of this.stoneHandler.foilStones){if(Math.sqrt((i-t.x)**2+(s-t.y)**2)<=40){this.pickedStoneObject=t,this.pickedStone=t,this.audioPlayer.playAudio(d);break}}this.clickTrailToggle=!0};setPickedUp(t,e){if(this.pickedStone&&this.pickedStone.frame<=99)return;const i=this.stoneHandler.handlePickStoneUp(t,e);i&&(this.pickedStoneObject=i,this.pickedStone=i,this.audioPlayer.playAudio(d),"Word"===this.levelData?.levelMeta?.levelType&&this.wordPuzzleLogic.setPickUpLetter(i?.text,i?.foilStoneIndex))}handleMouseMove=t=>{if(this.pickedStone&&this.pickedStone.frame<=99)return;let e=t.clientX,i=t.clientY;if(this.pickedStone){if(this.wordPuzzleLogic.checkIsWordPuzzle()){const s=this.stoneHandler.handleMovingStoneLetter(this.pickedStone,t.clientX,t.clientY);if(this.pickedStone=s,e=s.x,i=s.y,this.wordPuzzleLogic.checkIsWordPuzzle()){const t=this.stoneHandler.handleHoveringToAnotherStone(e,i,((t,e)=>this.wordPuzzleLogic.handleCheckHoveredStone(t,e)));t&&(this.wordPuzzleLogic.setPickUpLetter(t?.text,t?.foilStoneIndex),this.pickedStone=this.stoneHandler.resetStonePosition(this.width,this.pickedStone,this.pickedStoneObject),this.pickedStoneObject=t,this.pickedStone=t)}}else{let s=this.canvas.getBoundingClientRect();const n=t.clientX-s.left,a=t.clientY-s.top;this.monster.changeToDragAnimation(),this.pickedStone.x=n,this.pickedStone.y=a,e=n,i=a}this.monster.changeToDragAnimation()}this.clickTrailToggle&&this.trailParticles?.addTrailParticlesOnMove(e,i)};handleMouseClick=t=>{let e=this.canvas.getBoundingClientRect();const i=t.clientX-e.left,s=t.clientY-e.top;this.monster.onClick(i,s)&&(this.isGameStarted=!0,this.time=0,this.tutorial.setPlayMonsterClickAnimation(!1)),this.pauseButton.onClick(i,s)&&(this.audioPlayer.playButtonClickSound(),this.pauseGamePlay()),this.promptText.onClick(i,s)&&this.promptText.playSound()};handleTouchStart=t=>{if(this.pickedStone&&this.pickedStone.frame<=99)return;const e=t.touches[0];this.handleMouseDown({clientX:e.clientX,clientY:e.clientY}),this.trailParticles?.resetParticles()};handleTouchMove=t=>{const e=t.touches[0];this.handleMouseMove({clientX:e.clientX,clientY:e.clientY}),this.trailParticles?.addTrailParticlesOnMove(e.clientX,e.clientY)};handleTouchEnd=t=>{const e=t.changedTouches[0];this.handleMouseUp({clientX:e.clientX,clientY:e.clientY}),this.hasFed||this.monster.changeToIdleAnimation(),this.trailParticles?.resetParticles()};draw(t){this.isGameStarted||this.isPauseButtonClicked||(this.time=this.time+t,this.time>=5e3&&(this.isGameStarted=!0,this.time=0,this.tutorial.setPlayMonsterClickAnimation(!1))),this.imagesLoaded&&this.background?.draw(),this.pauseButton.draw(),this.levelIndicators.draw(),this.promptText.draw(t),this.monster.update(t),this.timerTicking.draw(),this.trailParticles?.draw(),this.isPauseButtonClicked&&this.isGameStarted&&(this.handleStoneLetterDrawing(t),this.pausePopup.draw()),this.isPauseButtonClicked||this.isGameStarted||0==this.counter&&this.tutorial.clickOnMonsterTutorial(t),this.isPauseButtonClicked&&!this.isGameStarted&&this.pausePopup.draw(),!this.isPauseButtonClicked&&this.isGameStarted&&this.handleStoneLetterDrawing(t)}handleStoneLetterDrawing(t){if(this.wordPuzzleLogic.checkIsWordPuzzle()){const{groupedObj:e}=this.wordPuzzleLogic.getValues();this.stoneHandler.drawWordPuzzleLetters(t,(t=>this.wordPuzzleLogic.validateShouldHideLetter(t)),e)}else this.stoneHandler.draw(t)}addEventListeners(){this.handler.addEventListener("mouseup",this.handleMouseUp,!1),this.handler.addEventListener("mousemove",this.handleMouseMove,!1),this.handler.addEventListener("mousedown",this.handleMouseDown,!1),this.handler.addEventListener("touchstart",this.handleTouchStart,!1),this.handler.addEventListener("touchmove",this.handleTouchMove,!1),this.handler.addEventListener("touchend",this.handleTouchEnd,!1),this.handler.addEventListener(nt,this.handleMouseClick,!1),document.addEventListener(at,this.handleVisibilityChange,!1)}removeEventListeners(){this.handler.removeEventListener(nt,this.handleMouseClick,!1),this.handler.removeEventListener("mouseup",this.handleMouseUp,!1),this.handler.removeEventListener("mousemove",this.handleMouseMove,!1),this.handler.removeEventListener("mousedown",this.handleMouseDown,!1),this.handler.removeEventListener("touchstart",this.handleTouchStart,!1),this.handler.removeEventListener("touchmove",this.handleTouchMove,!1),this.handler.removeEventListener("touchend",this.handleTouchEnd,!1)}loadPuzzle=t=>{this.removeEventListeners(),this.stonesCount=1;const e=Boolean(t);if(e&&this.logPuzzleEndFirebaseEvent(!1),this.counter+=1,this.isGameStarted=!1,this.counter===this.levelData.puzzles.length)this.levelIndicators.setIndicators(this.counter),this.logLevelEndFirebaseEvent(),ft.setGameLevelScore(this.levelData,this.score),this.switchSceneToEnd(ft.calculateStarCount(this.score),this.monsterPhaseNumber,this.levelNumber,e);else{const t=new CustomEvent(it,{detail:{counter:this.counter}});setTimeout((()=>{this.isDisposing||this.initNewPuzzle(t)}),e?0:4500)}};dispose=()=>{this.isDisposing=!0,this.audioPlayer.stopAllAudios(),this.monster.dispose(),this.timerTicking.dispose(),this.levelIndicators.dispose(),this.stoneHandler.dispose(),this.promptText.dispose(),document.removeEventListener(at,this.handleVisibilityChange,!1),this.removeEventListeners()};dispatchGameExitEvent(){if(!j.isRespect){const t=new CustomEvent("gameExit",{detail:{exited:!0}});window.dispatchEvent(t),console.log("Game exit event dispatched:",t)}}setSwitchToLevelSelectionWithExitEvent(){const t=this.switchToLevelSelection;this.switchToLevelSelection=(...e)=>(this.dispatchGameExitEvent(),t.apply(this,e))}checkStoneDropped(t,e,i=!1){return this.hasFed=!0,this.stoneHandler.isStoneLetterDropCorrect(t,e,i)}letterPuzzle(t){if(this.pickedStone&&this.pickedStone.frame<=99)return;const e=this.getRandomInt(0,1),i=this.checkStoneDropped(t,e);i?this.handleCorrectStoneDrop(e):this.handleWrongAnswer(),this.handleStoneDropEnd(i)}wordPuzzle(t){if(t.frame<=99)return;this.audioPlayer.stopFeedbackAudio(),t.x=-999,t.y=-999;const e=this.getRandomInt(0,1);this.hasFed=!0,this.wordPuzzleLogic.setGroupToDropped();const{droppedLetters:i}=this.wordPuzzleLogic.getValues(),s=this.wordPuzzleLogic.validateFedLetters();if(this.stoneHandler.processLetterDropFeedbackAudio(e,s,!0,i),s){if(this.wordPuzzleLogic.validateWordPuzzle())return this.handleCorrectStoneDrop(e),this.handleStoneDropEnd(s,"Word"),void(this.stonesCount=1);this.timerTicking.startTimer(),this.monster.changeToEatAnimation(),this.promptText.droppedStoneIndex("arabic"==Q?this.stonesCount:i.length),this.stonesCount++,this.resetToIdleAnimation((()=>{this.monster.changeToIdleAnimation(),this.hasFed=!1}),2e3)}else this.handleWrongAnswer(),this.handleStoneDropEnd(s,"Word"),this.stonesCount=1}resetToIdleAnimation(t,e){void 0!==this.resetAnimationID&&clearTimeout(this.resetAnimationID),this.resetAnimationID=setTimeout(t,e)}handleStoneDropEnd(t,e=null){this.logPuzzleEndFirebaseEvent(t,e),this.dispatchStoneDropEvent(t),this.loadPuzzle()}calculateScore(){const t=this.levelData.puzzles.length-(this.rightMoves+this.wrongMoves),e=this.rightMoves+this.wrongMoves+t;this.score=e>0?Math.round(this.rightMoves/e*100):0,isNaN(this.score)&&(this.score=0)}handleCorrectStoneDrop=t=>{this.rightMoves++,this.calculateScore(),this.feedbackTextEffects.wrapText(this.getRandomFeedBackText(t))};handleWrongAnswer=()=>{this.wrongMoves++};dispatchStoneDropEvent(t){const e=new CustomEvent(st,{detail:{isCorrect:t}});document.dispatchEvent(e)}initNewPuzzle(t){this.removeEventListeners(),this.isGameStarted=!1,this.time=0,this.wordPuzzleLogic.updatePuzzleLevel(t?.detail?.counter),this.pickedStone=null,document.dispatchEvent(t),this.addEventListeners(),this.audioPlayer.stopAllAudios(),this.startPuzzleTime(),this.hasFed=!1}logPuzzleEndFirebaseEvent(t,e){let i=Date.now();const{droppedLetters:s}=this.wordPuzzleLogic.getValues(),n={cr_user_id:$,ftm_language:Q,profile_number:0,version_number:document.getElementById("version-info-id").innerHTML,json_version_number:this.jsonVersionNumber,success_or_failure:t?"success":"failure",level_number:this.levelData.levelMeta.levelNumber,puzzle_number:this.counter,item_selected:"Word"==e?null==s||null==s?"TIMEOUT":s:null==this.pickedStone||null==this.pickedStone?"TIMEOUT":this.pickedStone?.text,target:this.stoneHandler.getCorrectTargetStone(),foils:this.stoneHandler.getFoilStones(),response_time:(i-this.puzzleTime)/1e3};this.firebaseIntegration.sendPuzzleCompletedEvent(n)}logLevelEndFirebaseEvent(){let t=Date.now();const e=this.levelData.puzzles.length-(this.rightMoves+this.wrongMoves),i=this.rightMoves,s={cr_user_id:$,ftm_language:Q,profile_number:0,version_number:document.getElementById("version-info-id").innerHTML,json_version_number:this.jsonVersionNumber,success_or_failure:ft.calculateStarCount(this.score)>=3?"success":"failure",number_of_successful_puzzles:i,right_moves:this.rightMoves,wrong_moves:this.wrongMoves,unanswered_questions:e,level_number:this.levelData.levelMeta.levelNumber,duration:(t-this.startTime)/1e3,score:this.score};if(this.firebaseIntegration.sendLevelCompletedEvent(s),Y.sendDataToContainer("gameData",s),!j.isRespect){const e=new CustomEvent("gameFinished",{detail:{score:this.score,maxScore:100,appVersion:document.getElementById("version-info-id").innerHTML,contentVersion:this.jsonVersionNumber,right_moves:this.rightMoves,wrong_moves:this.wrongMoves,duration:(t-this.startTime)/1e3,success_or_failure:ft.calculateStarCount(this.score)>=3?"success":"failure",level_number:this.levelData.levelMeta.levelNumber,number_of_successful_puzzles:i}});window.dispatchEvent(e),console.log("Game finished event dispatched:",e)}}startGameTime(){this.startTime=Date.now()}startPuzzleTime(){this.puzzleTime=Date.now()}pauseGamePlay=()=>{this.removeEventListeners(),this.isPauseButtonClicked=!0,this.stoneHandler.setGamePause(!0),this.pausePopup.addListner(),this.audioPlayer.stopAllAudios()};handleVisibilityChange=()=>{this.audioPlayer.stopAllAudios(),this.pauseGamePlay()}}async function jn(){try{const t=`./lang/${Q}/ftm_${Q}.json`,e=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to load JSON file: ${t}`);return await e.json()}catch(t){throw console.error("Error loading language-specific JSON file:",t),t}}class Rn{canvas;data;width;height;canvasElement;context;levels;gameLevelData;callBack;audioPlayer;images;loadedImages;imagesLoaded=!1;xDown;yDown;previousPlayedLevelNumber;levelSelectionPageIndex=0;levelNumber;levelsSectionCount;unlockLevelIndex;majVersion;minVersion;firebaseIntegration;background;rightBtnSize;rightBtnX;rightBtnY;leftBtnSize;leftBtnX;leftBtnY;levelButtons;constructor(t,e,i){this.canvas=t,this.data=e,this.width=t.width,this.height=t.height;let n=this;this.callBack=i,this.levelsSectionCount=n.data.levels.length/10>Math.floor(n.data.levels.length/10)?Math.floor(n.data.levels.length/10)+1:Math.floor(n.data.levels.length/10),this.levels=[],this.firebaseIntegration=new An,this.init(),this.canvasElement=document.getElementById("canvas"),this.context=this.canvasElement.getContext("2d"),this.createLevelButtons(),this.gameLevelData=ft.getAllGameLevelInfo(),this.audioPlayer=new Pt,this.unlockLevelIndex=-1;const a=et.DebugMode?localStorage.getItem(s+Q+"Debug"):localStorage.getItem(s+Q),o=parseInt(a??"0");this.previousPlayedLevelNumber=isNaN(o)||o<0?0:o,null!=this.previousPlayedLevelNumber&&(this.levelSelectionPageIndex=10*Math.floor(this.previousPlayedLevelNumber/10)),this.setupBg(),this.images={nextbtn:z,backbtn:"./assets/images/back_btn.webp"},R(this.images,(t=>{this.loadedImages=Object.assign({},t),this.imagesLoaded=!0,"visible"===document.visibilityState&&this.audioPlayer.playAudio(u)})),this.addListeners(),this.rightBtnSize=10,this.rightBtnX=.73,this.rightBtnY=1.3,this.leftBtnSize=10,this.leftBtnX=10,this.leftBtnY=1.3}async init(){const t=j.isRespect?await jn():await rt();this.majVersion=t.majversion,this.minVersion=t.minversion}setupBg=async()=>{this.background=await Dn(this.context,this.width,this.height,{LEVEL_SELECTION_BACKGROUND:"./assets/images/map.webp"},Mn)};async createLevelButtons(){const t=await H({balloonImg:"./assets/images/mapIcon.webp",specialBloonImg:"./assets/images/map_icon_monster_level_v01.webp",lockImg:"./assets/images/mapLock.webp",starImg:"./assets/images/star.webp"});var e;const i=[[[(e=this.canvas).width/10,e.height/10],[e.width/2.5,e.height/10],[e.width/3+e.width/2.8,e.height/10],[e.width/10,e.height/3],[e.width/2.5,e.height/3],[e.width/3+e.width/2.8,e.height/3],[e.width/10,e.height/1.8],[e.width/2.5,e.height/1.8],[e.width/3+e.width/2.8,e.height/1.8],[e.width/2.5,e.height/1.3]]][0].map(((e,i)=>On(e[0],e[1],i+1,t)));this.levels=await Promise.all(i),this.levelButtons=this.levels.map((t=>new Nt(this.canvas,this.context,{...t})))}addListeners(){document.getElementById("canvas").addEventListener("mousedown",this.handleMouseDown,!1),document.addEventListener("visibilitychange",this.pausePlayAudios,!1),document.getElementById("canvas").addEventListener("touchstart",this.handleTouchStart,!1),document.getElementById("canvas").addEventListener("touchmove",this.handleTouchMove,!1)}pausePlayAudios=()=>{"visible"===document.visibilityState?this.audioPlayer.playAudio(u):this.audioPlayer.stopAllAudios()};getTouches(t){return t.touches||t.originalEvent.touches}handleTouchStart=t=>{const e=this.getTouches(t)[0];this.xDown=e.clientX,this.yDown=e.clientY};handleTouchMove=t=>{if(!this.xDown||!this.yDown)return;let e=t.touches[0].clientX,i=t.touches[0].clientY,s=this.xDown-e,n=this.yDown-i;Math.abs(s)>Math.abs(n)&&(s>0?this.levelSelectionPageIndex!=10*this.levelsSectionCount-10&&(this.levelSelectionPageIndex=this.levelSelectionPageIndex+10,this.downButton(this.levelSelectionPageIndex)):(0!=this.levelSelectionPageIndex&&(this.levelSelectionPageIndex=this.levelSelectionPageIndex-10),this.downButton(this.levelSelectionPageIndex))),this.xDown=null,this.yDown=null};handleMouseDown=t=>{t.preventDefault();let e=document.getElementById("canvas").getBoundingClientRect();const i=t.clientX-e.left,s=t.clientY-e.top,n=(t,e=1.3)=>i>=t&&i<t+this.canvas.height/10&&s>this.canvas.height/e&&s<this.canvas.height/e+this.canvas.height/10,a=n(.7*this.canvas.width),o=n(this.canvas.width/10);if(o||a){const t=this.levelSelectionPageIndex;a&&t!=10*this.levelsSectionCount-10?(this.audioPlayer.playButtonClickSound(),this.levelSelectionPageIndex=t+10,this.rightBtnSize=10.5,this.rightBtnY=1.299):o&&0!=t&&(this.audioPlayer.playButtonClickSound(),this.levelSelectionPageIndex=t-10,this.leftBtnSize=10.3,this.leftBtnY=1.299),this.downButton(this.levelSelectionPageIndex)}for(let t of this.levelButtons)t.onClick(i,s,this.levelSelectionPageIndex-1,this.unlockLevelIndex+1,(t=>{this.audioPlayer.playButtonClickSound(),this.levelNumber=t+this.levelSelectionPageIndex-1,j.levelNum=this.levelNumber,this.startGame(this.levelNumber)}))};drawLevel(t,e){const i=t.levelData.index+this.levelSelectionPageIndex,s=i-1;this.unlockLevelIndex+1===s&&t.applyPulseEffect(),i<=this.data.levels.length&&(this.checkUnlockedLevel(e),t.draw(this.levelSelectionPageIndex,this.unlockLevelIndex,e,this.data.levels.length),et.DebugMode&&this.context.fillText(this.data.levels[i-1].levelMeta.levelType,t.levelData.x+t.btnSize/3.5,t.levelData.y+t.btnSize/1.3))}draw(){for(let t of this.levelButtons)this.drawLevel(t,this.gameLevelData)}downButton(t){t!=10*this.levelsSectionCount-10?(this.context.drawImage(this.loadedImages.nextbtn,this.canvas.width*this.rightBtnX,this.canvas.height/this.rightBtnY,this.canvas.height/this.rightBtnSize,this.canvas.height/this.rightBtnSize),this.rightBtnSize>10&&(this.rightBtnSize=this.rightBtnSize-.025),this.rightBtnY=this.rightBtnSize>10?1.299:1.3):(this.rightBtnSize=10,this.rightBtnX=.7,this.rightBtnY=1.3),0!=t?(this.context.drawImage(this.loadedImages.backbtn,this.canvas.width/this.leftBtnX,this.canvas.height/this.leftBtnY,this.canvas.height/this.leftBtnSize,this.canvas.height/this.leftBtnSize),this.leftBtnSize>10&&(this.leftBtnSize=this.leftBtnSize-.025),this.leftBtnY=this.leftBtnSize>10?1.299:1.3):(this.leftBtnSize=10,this.leftBtnX=10,this.leftBtnY=1.3)}checkUnlockedLevel(t){if(null!=t.length)for(let e of t)this.unlockLevelIndex<parseInt(e.levelNumber)&&e.starCount>=2&&(this.unlockLevelIndex=parseInt(e.levelNumber))}startGame(t){this.dispose(),this.audioPlayer.stopAllAudios();const e={currentLevelData:{...this.data.levels[t],levelNumber:t},selectedLevelNumber:t};this.logSelectedLevelEvent(),this.callBack(e,"LevelSelection")}logSelectedLevelEvent(){const t={cr_user_id:$,ftm_language:Q,profile_number:0,version_number:document.getElementById("version-info-id").innerHTML,json_version_number:this.majVersion&&this.minVersion?this.majVersion.toString()+"."+this.minVersion.toString():"",level_selected:this.levelNumber};this.firebaseIntegration.sendSelectedLevelEvent(t)}drawLevelSelection(){this.imagesLoaded&&(this.background?.draw(),this.draw(),this.downButton(this.levelSelectionPageIndex))}dispose(){this.audioPlayer.stopAllAudios(),document.getElementById("canvas").removeEventListener("mousedown",this.handleMouseDown,!1),document.removeEventListener("visibilitychange",this.pausePlayAudios,!1),document.getElementById("canvas").removeEventListener("touchstart",this.handleTouchStart,!1),document.getElementById("canvas").removeEventListener("touchmove",this.handleTouchMove,!1)}}class Hn{canvas;height;width;images;loadedImages;imagesLoaded;id;context;monster;closeButton;retryButton;nextButton;starCount;currentLevel;switchToGameplayCB;switchToLevelSelectionCB;data;background;audioPlayer;timeouts;starDrawnCount;isLastLevel;constructor(t,e,i,s,n,a,o,r,h,l){this.canvas=t,this.height=e,this.width=i,this.context=s,this.monster=new Tt(this.canvas,l,this.switchToReactionAnimation),this.switchToGameplayCB=o,this.switchToLevelSelectionCB=r,this.data=h,this.starDrawnCount=0,this.closeButton=new At(s,t,.2*this.width-.19*this.width/2,this.height/1.25),this.retryButton=new Mt(this.context,this.canvas,.5*this.width-.19*this.width/2,this.height/1.25),this.nextButton=new Dt(this.context,this.width,this.height,.8*this.width-.19*this.width/2,this.height/1.25),this.audioPlayer=new Pt,this.starCount=n,this.currentLevel=a,this.images={backgroundImg:"./assets/images/WIN_screen_bg.webp",star1Img:"./assets/images/pinStar1.webp",star2Img:"./assets/images/pinStar2.webp",star3Img:"./assets/images/pinStar3.webp",winBackgroundImg:w},R(this.images,(t=>{this.loadedImages=Object.assign({},t),this.imagesLoaded=!0,this.starAnimation()})),this.addEventListener(),this.audioPlayer=new Pt,this.setupBg(),this.isLastLevel=this.currentLevel!==this.data.levels[this.data.levels.length-1].levelMeta.levelNumber&&this.starCount>=2}setupBg=async()=>{const{BG_GROUP_IMGS:t,draw:e}=Bn(this.currentLevel,_n);this.background=await Dn(this.context,this.width,this.height,t,e)};switchToReactionAnimation=()=>{this.starCount<=1?(W()&&this.audioPlayer.playAudio("./assets/audios/LevelLoseFanfare.mp3"),this.monster.changeToSpitAnimation()):(W()&&(this.audioPlayer.playAudio("./assets/audios/LevelWinFanfare.mp3"),this.audioPlayer.playAudio(u)),this.monster.changeToEatAnimation())};draw(t){this.background?.draw(),this.imagesLoaded&&(this.context.drawImage(this.loadedImages.backgroundImg,0,0,this.width,this.height+.12*this.height),this.drawStars(),this.monster.update(t),this.closeButton.draw(),this.retryButton.draw(),this.isLastLevel&&this.nextButton.draw())}starAnimation(){this.timeouts=[{delay:500,count:1},{delay:1e3,count:2},{delay:1500,count:3}].map((t=>setTimeout((()=>{this.starDrawnCount=t.count}),t.delay)))}drawStars(){if(this.starCount>=1&&this.starDrawnCount>=1){try{Y.sendDataToContainer("star-count",this.starCount)}catch(t){console.error("Failed to send star count:",t)}this.context.drawImage(this.loadedImages.star1Img,.2*this.width-.19*this.width/2,.2*this.height,.19*this.width,.19*this.width),this.starCount<=3&&this.starCount>1&&this.starDrawnCount<=3&&this.starDrawnCount>1&&(this.context.drawImage(this.loadedImages.star2Img,.5*this.width-.19*this.width/2,.15*this.height,.19*this.width,.19*this.width),this.starCount>=3&&this.starDrawnCount>=3&&this.context.drawImage(this.loadedImages.star3Img,.82*this.width-.19*this.width/2,.2*this.height,.19*this.width,.19*this.width))}}addEventListener(){document.getElementById("canvas").addEventListener(nt,this.handleMouseClick,!1),document.addEventListener("visibilitychange",this.pauseAudios,!1)}handleMouseClick=t=>{var e=document.getElementById("canvas").getBoundingClientRect();const i=t.clientX-e.left,s=t.clientY-e.top;if(this.closeButton.onClick(i,s)&&(this.audioPlayer.playButtonClickSound(),this.switchToLevelSelectionCB("LevelEnd")),this.retryButton.onClick(i,s)){this.audioPlayer.playButtonClickSound();let t={currentLevelData:{...this.data.levels[this.currentLevel],levelNumber:this.currentLevel},selectedLevelNumber:this.currentLevel};this.switchToGameplayCB(t,"LevelEnd")}if(this.isLastLevel&&this.nextButton.onClick(i,s)){this.audioPlayer.playButtonClickSound();let t=Number(this.currentLevel)+1,e={currentLevelData:{...this.data.levels[t],levelNumber:t},selectedLevelNumber:t};this.switchToGameplayCB(e,"LevelEnd")}};pauseAudios=()=>{W()?this.starCount>=2&&this.audioPlayer.playAudio(u):this.audioPlayer.stopAllAudios()};dispose=()=>{this.monster.dispose(),this.audioPlayer.stopAllAudios(),this.timeouts.forEach((t=>clearTimeout(t))),document.getElementById("canvas").removeEventListener(nt,this.handleMouseClick,!1),document.removeEventListener("visibilitychange",this.pauseAudios,!1)}}class Xn{canvas;height;width;context;images;loadedImages;imagesLoaded;cloudXPosition=-500;stopCloudMoving=!1;cloudMovingTimeOut=0;removeLoading;constructor(t,e,i){this.canvas=document.getElementById("loading"),this.canvas.height=e,this.canvas.width=t,this.height=e,this.width=t,this.removeLoading=i,this.context=this.canvas.getContext("2d"),this.images={cloud6:"./assets/images/cloud_01.png",cloud7:"./assets/images/cloud_02.png",cloud8:"./assets/images/cloud_03.png"},R(this.images,(t=>{this.loadedImages=Object.assign({},t),this.imagesLoaded=!0}))}draw(t){this.context.clearRect(0,0,this.width,this.height),this.cloudXPosition+=.75*t,this.cloudMovingTimeOut+=t,this.cloudMovingTimeOut>2983&&this.removeLoading(),this.cloudXPosition>=.5*this.width&&!this.stopCloudMoving&&(this.cloudMovingTimeOut+=t,this.cloudMovingTimeOut>2e3&&(this.stopCloudMoving=!0,this.cloudXPosition=0)),this.imagesLoaded&&(this.stopCloudMoving?(this.context.drawImage(this.loadedImages.cloud6,0+this.cloudXPosition,.6*this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud6,.4*this.width+this.cloudXPosition,.15*this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud7,0+this.cloudXPosition,.15*this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud8,.4*-this.width+this.cloudXPosition,.15*-this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud8,.4*this.width+this.cloudXPosition,.15*-this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud8,.05*this.width+this.cloudXPosition,.2*-this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud8,.6*-this.width+this.cloudXPosition,.3*this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud7,.5*this.width+this.cloudXPosition,.4*this.height,this.width,.4*this.height),this.context.drawImage(this.loadedImages.cloud7,.4*-this.width+this.cloudXPosition,.7*this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud8,.4*this.width+this.cloudXPosition,.7*this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud6,.2*-this.width+this.cloudXPosition,.2*this.height,this.width,.5*this.height)):(this.context.drawImage(this.loadedImages.cloud6,this.cloudXPosition>=0?0:this.cloudXPosition,.6*this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud6,this.cloudXPosition>=.4*this.width?.4*this.width:this.cloudXPosition,.15*this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud7,this.cloudXPosition>=0?0:this.cloudXPosition,.15*this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud8,this.cloudXPosition>=.4*-this.width?.4*-this.width:this.cloudXPosition,.15*-this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud8,this.cloudXPosition>=.4*this.width?.4*this.width:this.cloudXPosition,.15*-this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud8,this.cloudXPosition>=.05*this.width?.05*this.width:this.cloudXPosition,.2*-this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud8,this.cloudXPosition>=.6*-this.width?.6*-this.width:this.cloudXPosition,.3*this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud7,this.cloudXPosition>=.5*this.width?.5*this.width:this.cloudXPosition,.4*this.height,this.width,.4*this.height),this.context.drawImage(this.loadedImages.cloud7,this.cloudXPosition>=.4*-this.width?.4*-this.width:this.cloudXPosition,.7*this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud8,this.cloudXPosition>=.4*this.width?.4*this.width:this.cloudXPosition,.7*this.height,this.width,.5*this.height),this.context.drawImage(this.loadedImages.cloud6,this.cloudXPosition>=.2*-this.width?.2*-this.width:this.cloudXPosition,.2*this.height,this.width,.5*this.height)))}initCloud=()=>{this.cloudXPosition=-500,this.stopCloudMoving=!1,this.cloudMovingTimeOut=0}}document.getElementById("toggle-btn");window.addEventListener("beforeinstallprompt",(t=>{t.preventDefault(),localStorage.setItem(i,"false")}));class Wn{canvas;data;width;height;startScene;levelSelectionScene;gameplayScene;levelEndScene;canavsElement;context;static SceneName;loadingScreen;loading=!1;lastTime=0;toggleBtn;titleTextElement;constructor(t,e,i){if(this.canvas=t,this.data=e,this.width=t.width,this.height=t.height,this.canavsElement=document.getElementById("canvas"),this.toggleBtn=document.getElementById("toggle-btn"),this.titleTextElement=document.getElementById("title"),window.addEventListener("beforeinstallprompt",this.handleInstallPrompt),this.context=this.canavsElement.getContext("2d"),this.loadingScreen=new Xn(this.width,this.height,this.removeLoading),null!=i){let s=i-1;e.levels&&e.levels[s]||(s=0);const n={currentLevelData:{...e.levels[s],levelNumber:s+1},selectedLevelNumber:s+1};let a=e.majVersion&&e.minVersion?e.majVersion.toString()+"."+e.minVersion.toString():"";this.gameplayScene=new Fn(t,n.currentLevelData,this.checkMonsterPhaseUpdation(),e.FeedbackTexts,e.rightToLeft,this.switchSceneToEndLevel,n.selectedLevelNumber,(()=>{this.switchSceneToLevelSelection(O)}),this.switchSceneToGameplay,a,e.FeedbackAudios),Wn.SceneName=r}this.startAnimationLoop()}startAnimationLoop(){const t=e=>{this.animation(e),requestAnimationFrame(t)};requestAnimationFrame(t)}devToggle(){this.toggleBtn.addEventListener("click",(()=>{this.toggleBtn.classList.toggle("on"),this.toggleBtn.classList.contains("on")?(et.DebugMode=!0,this.toggleBtn.innerText="Dev"):(et.DebugMode=!1,this.toggleBtn.innerText="Dev")}))}checkMonsterPhaseUpdation(){let t=ft.getTotalStarCount(),e=Math.floor(t/12)+1||1;return e<=4?e:4}animation=t=>{let e=t-this.lastTime;this.lastTime=t,this.context.clearRect(0,0,this.width,this.height),this.loading&&this.loadingScreen.draw(e),"StartScene1"===Wn.SceneName?this.startScene.animation(e):Wn.SceneName===o?this.levelSelectionScene&&this.levelSelectionScene.drawLevelSelection():Wn.SceneName===r?this.gameplayScene&&this.gameplayScene.draw(e):Wn.SceneName===h&&this.levelEndScene&&this.levelEndScene.draw(e)};switchSceneToGameplay=(t,e)=>{this.showLoading(),this.dispose(e);let i=this.data.majVersion&&this.data.minVersion?this.data.majVersion.toString()+"."+this.data.minVersion.toString():"";setTimeout((()=>{this.gameplayScene=new Fn(this.canvas,t.currentLevelData,this.checkMonsterPhaseUpdation(),this.data.FeedbackTexts,this.data.rightToLeft,this.switchSceneToEndLevel,t.selectedLevelNumber,(()=>{this.switchSceneToLevelSelection(O)}),this.switchSceneToGameplay,i,this.data.FeedbackAudios),Wn.SceneName=r}),800)};switchSceneToEndLevel=(t,e,i,s)=>{this.loadingScreen.initCloud(),setTimeout((()=>{this.dispose(O),this.levelEndScene=new Hn(this.canvas,this.height,this.width,this.context,t,i,this.switchSceneToGameplay,this.switchSceneToLevelSelection,this.data,e),Wn.SceneName=h}),s?0:4e3)};switchSceneToLevelSelection=t=>{this.showLoading(),this.dispose(t),setTimeout((()=>{this.levelSelectionScene=new Rn(this.canvas,this.data,this.switchSceneToGameplay),Wn.SceneName=o,this.titleTextElement.style.display="none"}),800)};dispose=t=>{"LevelSelection"==t?this.levelSelectionScene.dispose():t===O?this.gameplayScene.dispose():"StartScene"===t?this.startScene.dispose():"LevelEnd"==t&&this.levelEndScene.dispose()};showLoading=()=>{this.loadingScreen.initCloud(),this.loading=!0,document.getElementById("loading").style.zIndex="3"};removeLoading=()=>{document.getElementById("loading").style.zIndex="-1",this.loading=!1};handleInstallPrompt=t=>{t.preventDefault(),localStorage.setItem(i,"false")};static createForDirectGameStart(t,e,i){const s=new Wn(t,e);let n=i-1;e.levels&&e.levels[n]||(n=0);const a={currentLevelData:{...e.levels[n],levelNumber:n+1},selectedLevelNumber:n+1};let o=e.majVersion&&e.minVersion?e.majVersion.toString()+"."+e.minVersion.toString():"";return s.gameplayScene=new Fn(t,a.currentLevelData,s.checkMonsterPhaseUpdation(),e.FeedbackTexts,e.rightToLeft,s.switchSceneToEndLevel.bind(s),a.selectedLevelNumber,(()=>s.switchSceneToLevelSelection(O)),s.switchSceneToGameplay.bind(s),o,e.FeedbackAudios),Wn.SceneName=r,s.startScene=void 0,s}}try{self["workbox:window:4.3.1"]&&_()}catch(Vn){}var Vn=function(t,e){return new Promise((function(i){var s=new MessageChannel;s.port1.onmessage=function(t){return i(t.data)},t.postMessage(e,[s.port2])}))};function Un(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function Yn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}try{self["workbox:core:4.3.1"]&&_()}catch(Vn){}var Gn=function(){var t=this;this.promise=new Promise((function(e,i){t.resolve=e,t.reject=i}))},$n=function(t,e){return new URL(t,location).href===new URL(e,location).href},qn=function(t,e){Object.assign(this,e,{type:t})};function Kn(t){return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];try{return Promise.resolve(t.apply(this,e))}catch(t){return Promise.reject(t)}}}function Jn(t,e,i){return i?e?e(t):t:(t&&t.then||(t=Promise.resolve(t)),e?t.then(e):t)}function Qn(){}var Zn=function(t){var e,i;function s(e,i){var s;return void 0===i&&(i={}),(s=t.call(this)||this).t=e,s.i=i,s.o=0,s.u=new Gn,s.s=new Gn,s.h=new Gn,s.v=s.v.bind(Yn(Yn(s))),s.l=s.l.bind(Yn(Yn(s))),s.g=s.g.bind(Yn(Yn(s))),s.m=s.m.bind(Yn(Yn(s))),s}i=t,(e=s).prototype=Object.create(i.prototype),e.prototype.constructor=e,e.__proto__=i;var n,a,o=s.prototype;return o.register=Kn((function(t){var e,i,s=this,n=(void 0===t?{}:t).immediate,a=void 0!==n&&n;return e=function(){return s.p=Boolean(navigator.serviceWorker.controller),s.P=s.R(),Jn(s.k(),(function(t){s.B=t,s.P&&(s.O=s.P,s.s.resolve(s.P),s.h.resolve(s.P),s.j(s.P),s.P.addEventListener("statechange",s.l,{once:!0}));var e=s.B.waiting;return e&&$n(e.scriptURL,s.t)&&(s.O=e,Promise.resolve().then((function(){s.dispatchEvent(new qn("waiting",{sw:e,wasWaitingBeforeRegister:!0}))}))),s.O&&s.u.resolve(s.O),s.B.addEventListener("updatefound",s.g),navigator.serviceWorker.addEventListener("controllerchange",s.m,{once:!0}),"BroadcastChannel"in self&&(s.C=new BroadcastChannel("workbox"),s.C.addEventListener("message",s.v)),navigator.serviceWorker.addEventListener("message",s.v),s.B}))},(i=function(){if(!a&&"complete"!==document.readyState)return function(t,e){return t&&t.then?t.then(Qn):Promise.resolve()}(new Promise((function(t){return addEventListener("load",t)})))}())&&i.then?i.then(e):e()})),o.getSW=Kn((function(){return this.O||this.u.promise})),o.messageSW=Kn((function(t){return Jn(this.getSW(),(function(e){return Vn(e,t)}))})),o.R=function(){var t=navigator.serviceWorker.controller;if(t&&$n(t.scriptURL,this.t))return t},o.k=Kn((function(){var t=this;return function(t,e){try{var i=t()}catch(t){return e(t)}return i&&i.then?i.then(void 0,e):i}((function(){return Jn(navigator.serviceWorker.register(t.t,t.i),(function(e){return t.L=performance.now(),e}))}),(function(t){throw t}))})),o.j=function(t){Vn(t,{type:"WINDOW_READY",meta:"workbox-window"})},o.g=function(){var t=this.B.installing;this.o>0||!$n(t.scriptURL,this.t)||performance.now()>this.L+6e4?(this.W=t,this.B.removeEventListener("updatefound",this.g)):(this.O=t,this.u.resolve(t)),++this.o,t.addEventListener("statechange",this.l)},o.l=function(t){var e=this,i=t.target,s=i.state,n=i===this.W,a=n?"external":"",o={sw:i,originalEvent:t};!n&&this.p&&(o.isUpdate=!0),this.dispatchEvent(new qn(a+s,o)),"installed"===s?this._=setTimeout((function(){"installed"===s&&e.B.waiting===i&&e.dispatchEvent(new qn(a+"waiting",o))}),200):"activating"===s&&(clearTimeout(this._),n||this.s.resolve(i))},o.m=function(t){var e=this.O;e===navigator.serviceWorker.controller&&(this.dispatchEvent(new qn("controlling",{sw:e,originalEvent:t})),this.h.resolve(e))},o.v=function(t){var e=t.data;this.dispatchEvent(new qn("message",{data:e,originalEvent:t}))},n=s,(a=[{key:"active",get:function(){return this.s.promise}},{key:"controlling",get:function(){return this.h.promise}}])&&Un(n.prototype,a),s}(function(){function t(){this.D={}}var e=t.prototype;return e.addEventListener=function(t,e){this.T(t).add(e)},e.removeEventListener=function(t,e){this.T(t).delete(e)},e.dispatchEvent=function(t){t.target=this,this.T(t.type).forEach((function(e){return e(t)}))},e.T=function(t){return this.D[t]=this.D[t]||new Set},t}());new class{canvas;versionInfoElement;lang;is_cached;progressBar;progressBarContainer;channel;sceneHandler;loadingElement;majVersion;minVersion;dataModal;startSessionTime;titleTextElement;feedBackTextElement;currentProgress;logged25=!1;logged50=!1;logged75=!1;isCachingComplete=!1;firebaseIntegration;constructor(t){this.lang=t,this.currentProgress=10,this.canvas=document.getElementById("canvas"),this.channel=new BroadcastChannel("my-channel"),this.progressBar=document.getElementById("progress-bar"),this.titleTextElement=document.getElementById("title"),this.feedBackTextElement=document.getElementById("feedback-text"),this.progressBarContainer=document.getElementById("progress-bar-container"),this.versionInfoElement=document.getElementById("version-info-id"),this.loadingElement=document.getElementById("loading-screen"),this.is_cached=this.initializeCachedData(),this.firebaseIntegration=new An,this.startSessionTime=0,this.isCachingComplete=!0===this.is_cached.get(this.lang),this.init(),this.channel.addEventListener("message",this.handleServiceWorkerMessage),window.addEventListener("beforeunload",this.handleBeforeUnload),document.addEventListener(at,this.handleVisibilityChange),window.addEventListener("resize",this.handleResize.bind(this))}async init(){try{let t;if(window.Android&&"function"==typeof window.Android.getLessonId&&(t=window.Android.getLessonId(),""!=t&&(j.isDeepLink=!0)),j.isDeepLink&&""!=t&&this.handleDeepLinkWithCaching(t),window.onDataFromAndroid=function(t){Y._handleDataFromAndroid(t)},j.isRespect)try{await Y.requestDataFromContainer("score")}catch(t){console.error("Error in requestDataFromContainer promise:",t)}if(j.isRespect)try{const t=await Y.requestInstalledAppInfo();j.isRespect=t.isAppInstalled}catch(t){console.error("Error in installedAppInfo promise:",t)}const e=await j.getLanguageSpecificFont(this.lang);await this.loadAndCacheFont(e,`./assets/fonts/${e}.ttf`),await this.loadTitleFeedbackCustomFont(),await this.preloadGameAudios(),this.handleLoadingScreen(),this.setupCanvas();const i=j.isRespect?await jn():await rt();if(this.majVersion=i.majversion,this.minVersion=i.minversion,this.dataModal=this.createDataModal(i),this.globalInitialization(i),this.logSessionStartFirebaseEvent(),window.addEventListener("resize",(async()=>{this.handleResize(this.dataModal)})),Z)return void(j.isRespect?this.simulateFakeCachingProgress(this.lang,(()=>{this.sceneHandler=Wn.createForDirectGameStart(this.canvas,this.dataModal,Number(Z)),this.passingDataToContainer()})):(await this.registerWorkbox(),this.waitForCachingAndStartGame((()=>{this.sceneHandler=Wn.createForDirectGameStart(this.canvas,this.dataModal,Number(Z)),this.passingDataToContainer()}))));j.isRespect?this.simulateFakeCachingProgress(this.lang):await this.registerWorkbox();const n=localStorage.getItem(this.lang+"gamePlayedInfo"),a=n?JSON.parse(n).length-1:0,o=et.DebugMode?s+this.lang+"Debug":s+this.lang;localStorage.setItem(o,a.toString()),this.is_cached.has(this.lang)&&this.handleCachedScenario(this.dataModal),j.isRespect?this.simulateFakeCachingProgress(this.lang):await this.registerWorkbox()}catch(t){console.error("Error in init:",t)}}simulateFakeCachingProgress(t,e){[25,50,75,100].forEach(((i,s)=>{setTimeout((()=>{this.handleLoadingMessage({data:i,version:`${t}-fake-version`}),100===i&&(this.cacheLanguage(),this.hideLoadingScreen(),e&&e())}),700*s)}))}async loadTitleFeedbackCustomFont(){const t=vt[this.lang]||vt.default,e=`'${t}', sans-serif`;await this.loadAndCacheFont(t,`./assets/fonts/${t}.ttf`),[this.titleTextElement,this.feedBackTextElement].forEach((t=>{t&&(t.style.fontFamily=e)}))}logDownloadPercentageComplete(t,e){const i={cr_user_id:$,ftm_language:Q,profile_number:0,version_number:this.versionInfoElement.innerHTML,json_version_number:this.getJsonVersionNumber(),ms_since_session_start:e};switch(t){case 25:this.firebaseIntegration.sendDownload25PercentCompletedEvent(i);break;case 50:this.firebaseIntegration.sendDownload50PercentCompletedEvent(i);break;case 75:this.firebaseIntegration.sendDownload75PercentCompletedEvent(i);break;case 100:this.firebaseIntegration.sendDownloadCompletedEvent(i)}25===t&&this.logged25||50===t&&this.logged50||75===t&&this.logged75}logSessionStartFirebaseEvent(){let t=localStorage.getItem("lastSessionEndTime"),e=0;if(this.startSessionTime=(new Date).getTime(),t){let i=parseInt(t);isNaN(i)||(e=Math.abs((new Date).getTime()-i))}const i=parseFloat((e?e/864e5:0).toFixed(3)),s={cr_user_id:$,ftm_language:Q,profile_number:0,version_number:this.versionInfoElement.innerHTML,json_version_number:this.majVersion&&this.minVersion?this.majVersion.toString()+"."+this.minVersion.toString():"",days_since_last:i};this.firebaseIntegration.sendSessionStartEvent(s)}logSessionEndFirebaseEvent(){const t={cr_user_id:$,ftm_language:Q,profile_number:0,version_number:this.versionInfoElement.innerHTML,json_version_number:this.majVersion&&this.minVersion?this.majVersion.toString()+"."+this.minVersion.toString():"",duration:((new Date).getTime()-this.startSessionTime)/1e3};localStorage.setItem("lastSessionEndTime",(new Date).getTime().toString()),this.firebaseIntegration.sendSessionEndEvent(t)}initializeCachedData(){const t=localStorage.getItem(n);return t?new Map(JSON.parse(t)):new Map}async loadAndCacheFont(t,e){try{const i=await caches.open("fontCache");if(!await i.match(e)){const t=await fetch(e),s=await t.blob();await i.put(e,new Response(s))}const s=new FontFace(t,`url(${e}) format('truetype')`);await s.load(),document.fonts.add(s)}catch(t){console.error(`Failed to load and cache font: ${t}`)}}handleLoadingScreen=()=>{this.is_cached.get(Q)?(this.loadingElement.style.zIndex="-1",this.loadingElement.style.display="none",this.progressBarContainer.style.display="none",this.progressBar.style.display="none"):(this.progressBarContainer.style.display="flex",this.progressBar.style.display="flex",this.progressBar.style.width="10%")};async registerWorkbox(){if("serviceWorker"in navigator)try{const t=new Zn("./sw.js",{});await t.register(),await navigator.serviceWorker.ready,this.is_cached.has(this.lang)?fetch(ot+"?cache-bust="+(new Date).getTime(),{method:"GET",headers:{"Content-Type":"application/json","Cache-Control":"no-store"},cache:"no-store"}).then((async t=>{if(!t.ok)return void console.error("Failed to fetch the content file from the server!");const e=await t.json(),i=e.majversion+"."+e.minversion,s=localStorage.getItem("version"+Q.toLowerCase());if(i&&s!=i){var a=JSON.parse(localStorage.getItem("is_cached")).filter((t=>!t.toString().includes(Q)));localStorage.setItem(n,JSON.stringify(a)),localStorage.removeItem("version"+Q.toLowerCase()),caches.delete(Q),this.handleUpdateFoundMessage()}})).catch((t=>{console.error("Error fetching the content file: "+t)})):this.channel.postMessage({command:"Cache",data:this.lang}),navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage)}catch(t){console.error(`Failed to register service worker: ${t}`)}}setupCanvas(){this.canvas.height=window.innerHeight,this.canvas.width=window.screen.width>1080?768:window.innerWidth}createDataModal(t){return new ht(t.title,t.OtherAudios,t.Levels,t.FeedbackTexts,t.RightToLeft,t.FeedbackAudios,t.majversion,t.minversion,t.version)}globalInitialization(t){globalThis.aboutCompany=t.aboutCompany,globalThis.descriptionText=t.descriptionText}handleResize(t){this.is_cached.has(this.lang)&&(this.updateVersionInfoElement(t),this.setupCanvas(),this.reinitializeSceneHandler(t))}updateVersionInfoElement(t){this.is_cached.has(this.lang)&&(et.TestLink||et.DevelopmentLink)&&(t.majVersion&&t.minVersion?this.versionInfoElement.innerHTML+=`/j.v${t.majVersion}.${t.minVersion}`:t.version&&(this.versionInfoElement.innerHTML+=`/j.v${t.version}`),document.getElementById("toggle-btn").style.display="block")}reinitializeSceneHandler(t){delete this.sceneHandler,this.sceneHandler=new Wn(this.canvas,t),this.passingDataToContainer()}handleCachedScenario(t){this.updateVersionInfoElement(t),this.sceneHandler=new Wn(this.canvas,t),this.passingDataToContainer()}passingDataToContainer=()=>{window.Android&&window.Android.cachedStatus(1==this.is_cached.get(this.lang))};setContainerAppOrientation(){window.Android&&window.Android.setContainerAppOrientation("portrait")}handleUpdateFoundMessage(){confirm("Update Found\nPress ok to update")&&window.location.reload()}handleLoadingMessage=t=>{if(this.progressBarContainer&&this.progressBar){this.showProgressBar();let e=Date.now()-this.startSessionTime;const i=Math.min(100,Math.max(0,t.data));i>this.currentProgress&&(this.currentProgress=i,this.progressBar.style.width=`${this.currentProgress}%`,this.currentProgress>=25&&!this.logged25&&(this.logDownloadPercentageComplete(25,e),this.logged25=!0),this.currentProgress>=50&&!this.logged50&&(this.logDownloadPercentageComplete(50,e),this.logged50=!0),this.currentProgress>=75&&!this.logged75&&(this.logDownloadPercentageComplete(75,e),this.logged75=!0),this.isDownloadCompleted(this.currentProgress)&&(this.cacheLanguage(),this.logDownloadPercentageComplete(100,e),this.hideLoadingScreen()))}};startGameWithLevel(t){if(this.sceneHandler){const e={currentLevelData:{...this.dataModal.levels[t],levelNumber:t},selectedLevelNumber:t};this.sceneHandler.switchSceneToGameplay(e,"START")}else console.error("📱 FTM: Cannot start game - scene handler not initialized")}showProgressBar(){this.progressBarContainer.classList.add("visible"),this.progressBar.classList.add("visible")}isDownloadCompleted(t){return 100===t&&!this.is_cached.get(this.lang)}cacheLanguage(){try{this.is_cached.set(this.lang,!0),localStorage.setItem(n,JSON.stringify(Array.from(this.is_cached.entries()))),this.isCachingComplete=!0}catch(t){console.error("Error caching language:",t)}}getJsonVersionNumber(){return this.majVersion&&this.minVersion?this.majVersion+"."+this.minVersion:""}hideLoadingScreen(){try{localStorage.setItem("version"+this.lang,this.getJsonVersionNumber()),this.loadingElement.style.display="none",this.handleResize(this.dataModal)}catch(t){console.error("Error hiding loading screen:",t)}}handleServiceWorkerMessage=t=>{"Loading"===t.data.msg?this.handleLoadingMessage(t.data):"Update Found"===t.data.msg&&this.handleUpdateFoundMessage()};handleVisibilityChange=()=>{W()?this.logSessionStartFirebaseEvent():this.logSessionEndFirebaseEvent()};handleBeforeUnload=async t=>{this.logSessionEndFirebaseEvent(),this.dispose()};preloadGameAudios=async()=>{let t=g;return new Promise(((e,i)=>{const s=t.map((t=>(new Pt).preloadGameAudio(t)));Promise.all(s).then((()=>e())).catch((t=>{console.error("Error preloading audio:",t),i(t)}))}))};dispose(){this.channel.removeEventListener("message",this.handleServiceWorkerMessage),window.removeEventListener("beforeunload",this.handleBeforeUnload),document.removeEventListener(at,this.handleVisibilityChange),window.removeEventListener("resize",this.handleResize),navigator.serviceWorker&&navigator.serviceWorker.removeEventListener("message",this.handleServiceWorkerMessage)}handleDeepLinkStart(t){j.isDeepLink=!1;const e=Number(t);j.levelNum=e,this.startGameWithLevel(e)}handleDeepLinkWithCaching(t){const e=()=>{setTimeout((()=>{this.handleDeepLinkStart(t)}),2e3)};if(this.isCachingComplete)e();else{const t=()=>{this.isCachingComplete?e():setTimeout(t,200)};t()}}waitForCachingAndStartGame(t){const e=()=>{this.isCachingComplete?t():setTimeout(e,200)};e()}}(Q)})();